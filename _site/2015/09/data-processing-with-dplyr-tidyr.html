<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Data Processing with dplyr & tidyr</title>
    <meta name="description" content="">

    <link rel="stylesheet" href="http://bradleyboehmke.github.io//css/main.css">
    <link rel="canonical" href="http://bradleyboehmke.github.io/http://bradleyboehmke.github.io//2015/09/data-processing-with-dplyr-tidyr.html">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="http://bradleyboehmke.github.io/">Bradley Boehmke</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="http://bradleyboehmke.github.io//about/">About</a>
          
        
          
        
          
        
          
        
          
          <a class="page-link" href="http://bradleyboehmke.github.io//categoryview/">Archive</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
          <a class="page-link" href="http://bradleyboehmke.github.io//cv/">CV</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
          <a class="page-link" href="http://bradleyboehmke.github.io//tutorials/">Tutorials</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
          <a class="page-link" href="http://bradleyboehmke.github.io//tutorials/scraping_with_apis_DSCOE.Rmd">Scraping Data with APIs</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Data Processing with dplyr & tidyr</h1>
    <p class="post-meta">Sep 7, 2015 &nbsp; • &nbsp; Categories: 
      
            &nbsp;<a href="http://bradleyboehmke.github.io/categoryview/#programming" style="color: rgb(128,128,128)">programming</a>
      
       &nbsp; • &nbsp; Tags: 
      
            &nbsp;<a href="http://bradleyboehmke.github.io/categoryview/#r" style="color: rgb(128,128,128)">r</a>
      
            &nbsp;<a href="http://bradleyboehmke.github.io/categoryview/#data-wrangling" style="color: rgb(128,128,128)">data wrangling</a>
      
            &nbsp;<a href="http://bradleyboehmke.github.io/categoryview/#dplyr" style="color: rgb(128,128,128)">dplyr</a>
      
            &nbsp;<a href="http://bradleyboehmke.github.io/categoryview/#tidyr" style="color: rgb(128,128,128)">tidyr</a>
      
    </p>
      
      <br>
      
  </header>

  <article class="post-content">
    <blockquote>
  <p>It is often said that 80% of data analysis is spent on the process of cleaning and preparing the data. (Dasu and Johnson, 2003)</p>
</blockquote>

<p>Although many fundamental data processing functions exist in R, they have been a bit convoluted to date and have lacked consistent coding and the ability to easily flow together. <a href="https://www.rstudio.com/">R Studio</a> is driving a lot of new packages to collate data management tasks and better integrate them with other analysis activities. As a result, a lot of data processing tasks are becoming packaged in more cohesive and consistent ways which leads to more efficient code and easier to read syntax. This post covers two of these packages: <code class="highlighter-rouge">tidyr</code> &amp; <code class="highlighter-rouge">dplyr</code>.
<!--more--></p>

<p>The <code class="highlighter-rouge">tidyr</code> and <code class="highlighter-rouge">dplyr</code> packages provide fundamental functions for cleaning, processing, &amp; manipulating data. <a href="https://cran.r-project.org/web/packages/tidyr/index.html"><code class="highlighter-rouge">tidyr</code></a> is a package built for the sole purpose of simplifying the process of creating <a href="http://vita.had.co.nz/papers/tidy-data.html">tidy data</a>. In this tutorial I’ll provides you with the basic understanding of the four fundamental functions of data tidying that tidyr provides:</p>

<ul>
  <li><a href="#gather"><code class="highlighter-rouge">gather()</code></a></li>
  <li><a href="#spread"><code class="highlighter-rouge">spread()</code></a></li>
  <li><a href="#separate"><code class="highlighter-rouge">separate()</code></a></li>
  <li><a href="#unite"><code class="highlighter-rouge">unite()</code></a></li>
</ul>

<p><a href="https://cran.r-project.org/web/packages/dplyr/index.html"><code class="highlighter-rouge">dplyr</code></a> is a package built for muliple purposes but with a focus on the process of manipulating, sorting, summarizing, and joining data frames. In this tutorial I’ll introduce you to the basic data transformation functions offered by the dplyr package:</p>

<ul>
  <li><a href="#select"><code class="highlighter-rouge">select()</code></a></li>
  <li><a href="#filter"><code class="highlighter-rouge">filter()</code></a></li>
  <li><a href="#group"><code class="highlighter-rouge">group_by()</code></a></li>
  <li><a href="#summarise"><code class="highlighter-rouge">summarise()</code></a></li>
  <li><a href="#arrange"><code class="highlighter-rouge">arrange()</code></a></li>
  <li><a href="#join"><code class="highlighter-rouge">join()</code></a></li>
  <li><a href="#mutate"><code class="highlighter-rouge">mutate()</code></a></li>
</ul>

<p>But prior to jumping into these packages and functions we’ll first take a detour to introduce a simple little mechanism that <code class="highlighter-rouge">tidyr</code> and <code class="highlighter-rouge">dplyr</code> leverage that is transforming the way we read and write code.</p>

<center><hr width="50%" /></center>

<p><br /></p>

<h2 id="u-operatoru"><u>%&gt;% Operator</u></h2>
<p>Although not required, the tidyr and dplyr packages make use of the pipe operator <code class="highlighter-rouge">%&gt;%</code> developed by <a href="https://twitter.com/stefanbache">Stefan Milton Bache</a> in the R package <a href="http://cran.r-project.org/web/packages/magrittr/magrittr.pdf">magrittr</a>.  Although all the functions in tidyr and dplyr <em>can be used without the pipe operator</em>, one of the great conveniences these packages provide is the ability to string multiple functions together by incorporating <code class="highlighter-rouge">%&gt;%</code>.</p>

<p>This operator will forward a value, or the result of an expression, into the next function call/expression.  For instance a function to filter data can be written as:</p>

<center>filter(data, variable == <em>numeric_value</em>)</center>

<center><em><u>or</u></em></center>

<center>data %&gt;% filter(variable == <em>numeric_value</em>)</center>

<p><br /></p>

<p>Both functions complete the same task and the benefit of using <code class="highlighter-rouge">%&gt;%</code> is not evident; however, when you desire to perform multiple functions its advantage becomes obvious.  For instance, if we want to filter some data, summarize it, and then order the summarized results we would write it out as:</p>

<p>  <u>Nested Option:</u></p>

<p>    arrange(<br />
            summarize(<br />
                filter(data, variable == <em>numeric_value</em>),<br />
                Total = sum(variable)<br />
            ),<br />
        desc(Total)<br />
    )</p>

<p><br />
            <em><u>or</u></em>
<br /></p>

<p>  <u>Multiple Object Option:</u></p>

<p>      a &lt;- filter(data, variable == <em>numeric_value</em>)<br />
      b &lt;- summarise(a, Total = sum(variable))<br />
      c &lt;- arrange(b, desc(Total))<br /></p>

<p><br />
            <em><u>or</u></em>
<br /></p>

<p>  <u>%&gt;% Option:</u></p>

<p>     data %&gt;%<br />
            filter(variable == “value”) %&gt;%<br />
            summarise(Total = sum(variable)) %&gt;%<br />
            arrange(desc(Total))</p>

<p><br /></p>

<p>As your function tasks get longer the <code class="highlighter-rouge">%&gt;%</code> operator becomes more efficient <em><u>and</u></em> makes your code more legible.  In addition, although not covered in this tutorial, the <code class="highlighter-rouge">%&gt;%</code> operator allows you to flow from data manipulation tasks straight into vizualization functions <em>(via ggplot and ggvis)</em> and also into many analytic functions.</p>

<p>To learn more about the <code class="highlighter-rouge">%&gt;%</code> operator and the magrittr package visit any of the following:</p>

<ul>
  <li><a href="http://cran.r-project.org/web/packages/magrittr/vignettes/magrittr.html">http://cran.r-project.org/web/packages/magrittr/vignettes/magrittr.html</a></li>
  <li><a href="http://www.r-bloggers.com/simpler-r-coding-with-pipes-the-present-and-future-of-the-magrittr-package/">http://www.r-bloggers.com/simpler-r-coding-with-pipes-the-present-and-future-of-the-magrittr-package/</a></li>
  <li><a href="http://blog.revolutionanalytics.com/2014/07/magrittr-simplifying-r-code-with-pipes.html">http://blog.revolutionanalytics.com/2014/07/magrittr-simplifying-r-code-with-pipes.html</a></li>
</ul>

<p><br /></p>

<p><a href="#">Go to top</a></p>

<center><hr width="50%" /></center>

<p><br /></p>

<h2 id="utidyr-operationsu"><u>tidyr Operations</u></h2>

<p>There are four fundamental functions of data tidying:</p>

<ul>
  <li><a href="#gather"><code class="highlighter-rouge">gather()</code></a> takes multiple columns, and gathers them into key-value pairs: it makes “wide” data longer</li>
  <li><a href="#spread"><code class="highlighter-rouge">spread()</code></a> takes two columns (key &amp; value) and spreads in to multiple columns, it makes “long” data wider</li>
  <li><a href="#separate"><code class="highlighter-rouge">separate()</code></a> splits a single column into multiple columns</li>
  <li><a href="#unite"><code class="highlighter-rouge">unite()</code></a> combines multiple columns into a single column</li>
</ul>

<p><br /><br /></p>

<p><a id="gather"> </a></p>

<h3 id="ugather--functionu"><u>gather( ) function</u>:</h3>
<p><strong>Objective:</strong> Reshaping wide format to long format</p>

<p><strong>Description:</strong> There are times when our data is considered unstacked and a common attribute of concern is spread out across columns.  To reformat the data such that these common attributes are <em>gathered</em> together as a single variable, the <code class="highlighter-rouge">gather()</code> function will take multiple columns and collapse them into key-value pairs, duplicating all other columns as needed.</p>

<p><strong>Complement to:</strong>  <a href="#spread"><code class="highlighter-rouge">spread()</code></a></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">Function</span><span class="o">:</span>       <span class="n">gather</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="k">...</span><span class="p">,</span> <span class="n">na.rm</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">convert</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span>
<span class="n">Same</span> <span class="n">as</span><span class="o">:</span>        <span class="n">data</span> <span class="o">%&gt;%</span> <span class="n">gather</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="k">...</span><span class="p">,</span> <span class="n">na.rm</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">,</span> <span class="n">convert</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span>

<span class="n">Arguments</span><span class="o">:</span>
        <span class="n">data</span><span class="o">:</span>           <span class="n">data</span> <span class="n">frame</span>
        <span class="n">key</span><span class="o">:</span>            <span class="n">column</span> <span class="n">name</span> <span class="n">representing</span> <span class="n">new</span> <span class="n">variable</span>
        <span class="n">value</span><span class="o">:</span>          <span class="n">column</span> <span class="n">name</span> <span class="n">representing</span> <span class="n">variable</span> <span class="n">values</span>
        <span class="k">...</span><span class="o">:</span>            <span class="n">names</span> <span class="n">of</span> <span class="n">columns</span> <span class="n">to</span> <span class="n">gather</span> <span class="p">(</span><span class="n">or</span> <span class="n">not</span> <span class="n">gather</span><span class="p">)</span>
        <span class="n">na.rm</span><span class="o">:</span>          <span class="n">option</span> <span class="n">to</span> <span class="n">remove</span> <span class="n">observations</span> <span class="n">with</span> <span class="n">missing</span> <span class="n">values</span> <span class="p">(</span><span class="n">represented</span> <span class="n">by</span> <span class="n">NAs</span><span class="p">)</span>
        <span class="n">convert</span><span class="o">:</span>        <span class="k">if</span> <span class="n">TRUE</span> <span class="n">will</span> <span class="n">automatically</span> <span class="n">convert</span> <span class="n">values</span> <span class="n">to</span> <span class="n">logical</span><span class="p">,</span> <span class="n">integer</span><span class="p">,</span> <span class="n">numeric</span><span class="p">,</span> <span class="n">complex</span> <span class="n">or</span> 
                        <span class="n">factor</span> <span class="n">as</span> <span class="n">appropriate</span></code></pre></figure>

<p><br /></p>

<p><strong>Example</strong></p>

<p>We’ll start with the following data set:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## Source: local data frame [12 x 6]
## 
##    Group  Year Qtr.1 Qtr.2 Qtr.3 Qtr.4
##    (int) (int) (int) (int) (int) (int)
## 1      1  2006    15    16    19    17
## 2      1  2007    12    13    27    23
## 3      1  2008    22    22    24    20
## 4      1  2009    10    14    20    16
## 5      2  2006    12    13    25    18
## 6      2  2007    16    14    21    19
## 7      2  2008    13    11    29    15
## 8      2  2009    23    20    26    20
## 9      3  2006    11    12    22    16
## 10     3  2007    13    11    27    21
## 11     3  2008    17    12    23    19
## 12     3  2009    14     9    31    24</code></pre></figure>

<p><br /></p>

<p>This data is considered wide since the <em><u>time</u></em> variable (represented as quarters) is structured such that each quarter represents a variable. To re-structure the time component as an individual variable, we can <em>gather</em> each quarter within one column variable and also <em>gather</em> the values associated with each quarter in a second column variable.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">long_DF</span> <span class="o">&lt;-</span> <span class="n">DF</span> <span class="o">%&gt;%</span> <span class="n">gather</span><span class="p">(</span><span class="n">Quarter</span><span class="p">,</span> <span class="n">Revenue</span><span class="p">,</span> <span class="n">Qtr.1</span><span class="o">:</span><span class="n">Qtr.4</span><span class="p">)</span>
<span class="n">head</span><span class="p">(</span><span class="n">long_DF</span><span class="p">,</span> <span class="m">24</span><span class="p">)</span>  <span class="err">#</span> <span class="n">note</span><span class="p">,</span> <span class="k">for</span> <span class="n">brevity</span><span class="p">,</span> <span class="n">I</span> <span class="n">only</span> <span class="n">show</span> <span class="n">the</span> <span class="n">data</span> <span class="k">for</span> <span class="n">the</span> <span class="n">first</span> <span class="n">two</span> <span class="n">years</span> </code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## Source: local data frame [24 x 4]
## 
##    Group  Year Quarter Revenue
##    (int) (int)  (fctr)   (int)
## 1      1  2006   Qtr.1      15
## 2      1  2007   Qtr.1      12
## 3      1  2008   Qtr.1      22
## 4      1  2009   Qtr.1      10
## 5      2  2006   Qtr.1      12
## 6      2  2007   Qtr.1      16
## 7      2  2008   Qtr.1      13
## 8      2  2009   Qtr.1      23
## 9      3  2006   Qtr.1      11
## 10     3  2007   Qtr.1      13
## ..   ...   ...     ...     ...</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">These</span> <span class="n">all</span> <span class="n">produce</span> <span class="n">the</span> <span class="n">same</span> <span class="n">results</span><span class="o">:</span>
        <span class="n">DF</span> <span class="o">%&gt;%</span> <span class="n">gather</span><span class="p">(</span><span class="n">Quarter</span><span class="p">,</span> <span class="n">Revenue</span><span class="p">,</span> <span class="n">Qtr.1</span><span class="o">:</span><span class="n">Qtr.4</span><span class="p">)</span>
        <span class="n">DF</span> <span class="o">%&gt;%</span> <span class="n">gather</span><span class="p">(</span><span class="n">Quarter</span><span class="p">,</span> <span class="n">Revenue</span><span class="p">,</span> <span class="o">-</span><span class="n">Group</span><span class="p">,</span> <span class="o">-</span><span class="n">Year</span><span class="p">)</span>
        <span class="n">DF</span> <span class="o">%&gt;%</span> <span class="n">gather</span><span class="p">(</span><span class="n">Quarter</span><span class="p">,</span> <span class="n">Revenue</span><span class="p">,</span> <span class="m">3</span><span class="o">:</span><span class="m">6</span><span class="p">)</span>
        <span class="n">DF</span> <span class="o">%&gt;%</span> <span class="n">gather</span><span class="p">(</span><span class="n">Quarter</span><span class="p">,</span> <span class="n">Revenue</span><span class="p">,</span> <span class="n">Qtr.1</span><span class="p">,</span> <span class="n">Qtr.2</span><span class="p">,</span> <span class="n">Qtr.3</span><span class="p">,</span> <span class="n">Qtr.4</span><span class="p">)</span>

<span class="n">Also</span> <span class="n">note</span> <span class="n">that</span> <span class="k">if</span> <span class="n">you</span> <span class="n">do</span> <span class="n">not</span> <span class="n">supply</span> <span class="n">arguments</span> <span class="k">for</span> <span class="n">na.rm</span> <span class="n">or</span> <span class="n">convert</span> <span class="n">values</span> <span class="n">then</span> <span class="n">the</span> <span class="n">defaults</span> <span class="n">are</span> <span class="n">used</span></code></pre></figure>

<p><a href="#">Go to top</a></p>

<p><br />
<a id="separate"> </a></p>

<h3 id="useparate--functionu"><u>separate( ) function</u>:</h3>
<p><strong>Objective:</strong> Splitting a single variable into two</p>

<p><strong>Description:</strong> Many times a single column variable will capture multiple variables, or even parts of a variable you just don’t care about.  Some examples include:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##   Grp_Ind    Yr_Mo       City_State        First_Last Extra_variable
## 1     1.a 2006_Jan      Dayton (OH) George Washington   XX01person_1
## 2     1.b 2006_Feb Grand Forks (ND)        John Adams   XX02person_2
## 3     1.c 2006_Mar       Fargo (ND)  Thomas Jefferson   XX03person_3
## 4     2.a 2007_Jan   Rochester (MN)     James Madison   XX04person_4
## 5     2.b 2007_Feb     Dubuque (IA)      James Monroe   XX05person_5
## 6     2.c 2007_Mar Ft. Collins (CO)        John Adams   XX06person_6
## 7     3.a 2008_Jan   Lake City (MN)    Andrew Jackson   XX07person_7
## 8     3.b 2008_Feb    Rushford (MN)  Martin Van Buren   XX08person_8
## 9     3.c 2008_Mar          Unknown  William Harrison   XX09person_9</code></pre></figure>

<p><br /></p>

<p>In each of these cases, our objective may be to <em>separate</em> characters within the variable string. This can be accomplished using the <code class="highlighter-rouge">separate()</code> function which turns a single character column into multiple columns.</p>

<p><strong>Complement to:</strong> <a href="#unite"><code class="highlighter-rouge">unite()</code></a></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">Function</span><span class="o">:</span>       <span class="n">separate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">into</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">" "</span><span class="p">,</span> <span class="n">remove</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">convert</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span>
<span class="n">Same</span> <span class="n">as</span><span class="o">:</span>        <span class="n">data</span> <span class="o">%&gt;%</span> <span class="n">separate</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">into</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">" "</span><span class="p">,</span> <span class="n">remove</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">convert</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span>

<span class="n">Arguments</span><span class="o">:</span>
        <span class="n">data</span><span class="o">:</span>           <span class="n">data</span> <span class="n">frame</span>
        <span class="n">col</span><span class="o">:</span>            <span class="n">column</span> <span class="n">name</span> <span class="n">representing</span> <span class="n">current</span> <span class="n">variable</span>
        <span class="n">into</span><span class="o">:</span>           <span class="n">names</span> <span class="n">of</span> <span class="n">variables</span> <span class="n">representing</span> <span class="n">new</span> <span class="n">variables</span>
        <span class="n">sep</span><span class="o">:</span>            <span class="n">how</span> <span class="n">to</span> <span class="n">separate</span> <span class="n">current</span> <span class="n">variable</span> <span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">or</span> <span class="n">symbol</span><span class="p">)</span>
        <span class="n">remove</span><span class="o">:</span>         <span class="k">if</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">remove</span> <span class="n">input</span> <span class="n">column</span> <span class="n">from</span> <span class="n">output</span> <span class="n">data</span> <span class="n">frame</span>
        <span class="n">convert</span><span class="o">:</span>        <span class="k">if</span> <span class="n">TRUE</span> <span class="n">will</span> <span class="n">automatically</span> <span class="n">convert</span> <span class="n">values</span> <span class="n">to</span> <span class="n">logical</span><span class="p">,</span> <span class="n">integer</span><span class="p">,</span> <span class="n">numeric</span><span class="p">,</span> <span class="n">complex</span> <span class="n">or</span> 
                        <span class="n">factor</span> <span class="n">as</span> <span class="n">appropriate</span></code></pre></figure>

<p><strong>Example</strong></p>

<p>We can go back to our <strong>long_DF</strong> dataframe we created above in which way may desire to clean up or separate the <em>Quarter</em> variable.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## Source: local data frame [6 x 4]
## 
##   Group  Year Quarter Revenue
##   (int) (int)  (fctr)   (int)
## 1     1  2006   Qtr.1      15
## 2     1  2007   Qtr.1      12
## 3     1  2008   Qtr.1      22
## 4     1  2009   Qtr.1      10
## 5     2  2006   Qtr.1      12
## 6     2  2007   Qtr.1      16</code></pre></figure>

<p><br /></p>

<p>By applying the <code class="highlighter-rouge">separate()</code> function we get the following:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">separate_DF</span> <span class="o">&lt;-</span> <span class="n">long_DF</span> <span class="o">%&gt;%</span> <span class="n">separate</span><span class="p">(</span><span class="n">Quarter</span><span class="p">,</span> <span class="n">c</span><span class="p">(</span><span class="s2">"Time_Interval"</span><span class="p">,</span> <span class="s2">"Interval_ID"</span><span class="p">))</span>
<span class="n">head</span><span class="p">(</span><span class="n">separate_DF</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## Source: local data frame [10 x 5]
## 
##    Group  Year Time_Interval Interval_ID Revenue
##    (int) (int)         (chr)       (chr)   (int)
## 1      1  2006           Qtr           1      15
## 2      1  2007           Qtr           1      12
## 3      1  2008           Qtr           1      22
## 4      1  2009           Qtr           1      10
## 5      2  2006           Qtr           1      12
## 6      2  2007           Qtr           1      16
## 7      2  2008           Qtr           1      13
## 8      2  2009           Qtr           1      23
## 9      3  2006           Qtr           1      11
## 10     3  2007           Qtr           1      13</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">These</span> <span class="n">produce</span> <span class="n">the</span> <span class="n">same</span> <span class="n">results</span><span class="o">:</span>
        <span class="n">long_DF</span> <span class="o">%&gt;%</span> <span class="n">separate</span><span class="p">(</span><span class="n">Quarter</span><span class="p">,</span> <span class="n">c</span><span class="p">(</span><span class="s2">"Time_Interval"</span><span class="p">,</span> <span class="s2">"Interval_ID"</span><span class="p">))</span>
        <span class="n">long_DF</span> <span class="o">%&gt;%</span> <span class="n">separate</span><span class="p">(</span><span class="n">Quarter</span><span class="p">,</span> <span class="n">c</span><span class="p">(</span><span class="s2">"Time_Interval"</span><span class="p">,</span> <span class="s2">"Interval_ID"</span><span class="p">),</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">"\\."</span><span class="p">)</span></code></pre></figure>

<p><a href="#">Go to top</a></p>

<p><br />
<a id="unite"> </a></p>

<h3 id="uunite--functionu"><u>unite( ) function</u>:</h3>
<p><strong>Objective:</strong> Merging two variables into one</p>

<p><strong>Description:</strong> There may be a time in which we would like to combine the values of two variables.  The <code class="highlighter-rouge">unite()</code> function is a convenience function to paste together multiple variable values into one.  In essence, it combines two variables of a single observation into one variable.</p>

<p><strong>Complement to:</strong>  <a href="#separate"><code class="highlighter-rouge">separate()</code></a></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">Function</span><span class="o">:</span>       <span class="n">unite</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="k">...</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">" "</span><span class="p">,</span> <span class="n">remove</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span>
<span class="n">Same</span> <span class="n">as</span><span class="o">:</span>        <span class="n">data</span> <span class="o">%&gt;%</span> <span class="n">unite</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="k">...</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">" "</span><span class="p">,</span> <span class="n">remove</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span>

<span class="n">Arguments</span><span class="o">:</span>
        <span class="n">data</span><span class="o">:</span>           <span class="n">data</span> <span class="n">frame</span>
        <span class="n">col</span><span class="o">:</span>            <span class="n">column</span> <span class="n">name</span> <span class="n">of</span> <span class="n">new</span> <span class="s2">"merged"</span> <span class="n">column</span>
        <span class="k">...</span><span class="o">:</span>            <span class="n">names</span> <span class="n">of</span> <span class="n">columns</span> <span class="n">to</span> <span class="n">merge</span>
        <span class="n">sep</span><span class="o">:</span>            <span class="n">separator</span> <span class="n">to</span> <span class="n">use</span> <span class="n">between</span> <span class="n">merged</span> <span class="n">values</span>
        <span class="n">remove</span><span class="o">:</span>         <span class="k">if</span> <span class="n">TRUE</span><span class="p">,</span> <span class="n">remove</span> <span class="n">input</span> <span class="n">column</span> <span class="n">from</span> <span class="n">output</span> <span class="n">data</span> <span class="n">frame</span></code></pre></figure>

<p><br /></p>

<p><strong>Example</strong></p>

<p>Using the <strong>separate_DF</strong> dataframe we created above, we can re-unite the <em>Time_Interval</em> and <em>Interval_ID</em> variables we created and re-create the original <em>Quarter</em> variable we had in the <strong>long_DF</strong> dataframe.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">unite_DF</span> <span class="o">&lt;-</span> <span class="n">separate_DF</span> <span class="o">%&gt;%</span> <span class="n">unite</span><span class="p">(</span><span class="n">Quarter</span><span class="p">,</span> <span class="n">Time_Interval</span><span class="p">,</span> <span class="n">Interval_ID</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">"."</span><span class="p">)</span>
<span class="n">head</span><span class="p">(</span><span class="n">unite_DF</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## Source: local data frame [10 x 4]
## 
##    Group  Year Quarter Revenue
##    (int) (int)   (chr)   (int)
## 1      1  2006   Qtr.1      15
## 2      1  2007   Qtr.1      12
## 3      1  2008   Qtr.1      22
## 4      1  2009   Qtr.1      10
## 5      2  2006   Qtr.1      12
## 6      2  2007   Qtr.1      16
## 7      2  2008   Qtr.1      13
## 8      2  2009   Qtr.1      23
## 9      3  2006   Qtr.1      11
## 10     3  2007   Qtr.1      13</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">These</span> <span class="n">produce</span> <span class="n">the</span> <span class="n">same</span> <span class="n">results</span><span class="o">:</span>
        <span class="n">separate_DF</span> <span class="o">%&gt;%</span> <span class="n">unite</span><span class="p">(</span><span class="n">Quarter</span><span class="p">,</span> <span class="n">Time_Interval</span><span class="p">,</span> <span class="n">Interval_ID</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">"_"</span><span class="p">)</span>
        <span class="n">separate_DF</span> <span class="o">%&gt;%</span> <span class="n">unite</span><span class="p">(</span><span class="n">Quarter</span><span class="p">,</span> <span class="n">Time_Interval</span><span class="p">,</span> <span class="n">Interval_ID</span><span class="p">)</span>

<span class="n">If</span> <span class="n">no</span> <span class="n">spearator</span> <span class="n">is</span> <span class="n">identified</span><span class="p">,</span> <span class="s2">"_"</span> <span class="n">will</span> <span class="n">automatically</span> <span class="n">be</span> <span class="n">used</span></code></pre></figure>

<p><a href="#">Go to top</a></p>

<p><br />
<a id="spread"> </a></p>

<h3 id="uspread--functionu"><u>spread( ) function</u>:</h3>

<p><strong>Objective:</strong> Reshaping long format to wide format</p>

<p><strong>Description:</strong> There are times when we are required to turn long formatted data into wide formatted data.  The <code class="highlighter-rouge">spread()</code> function spreads a key-value pair across multiple columns.</p>

<p><strong>Complement to:</strong> <a href="#gather"><code class="highlighter-rouge">gather()</code></a></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">Function</span><span class="o">:</span>       <span class="n">spread</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">NA</span><span class="p">,</span> <span class="n">convert</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span>
<span class="n">Same</span> <span class="n">as</span><span class="o">:</span>        <span class="n">data</span> <span class="o">%&gt;%</span> <span class="n">spread</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">NA</span><span class="p">,</span> <span class="n">convert</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span>

<span class="n">Arguments</span><span class="o">:</span>
        <span class="n">data</span><span class="o">:</span>           <span class="n">data</span> <span class="n">frame</span>
        <span class="n">key</span><span class="o">:</span>            <span class="n">column</span> <span class="n">values</span> <span class="n">to</span> <span class="n">convert</span> <span class="n">to</span> <span class="n">multiple</span> <span class="n">columns</span>
        <span class="n">value</span><span class="o">:</span>          <span class="n">single</span> <span class="n">column</span> <span class="n">values</span> <span class="n">to</span> <span class="n">convert</span> <span class="n">to</span> <span class="n">multiple</span> <span class="n">columns</span><span class="s1">' values 
        fill:           If there isn'</span><span class="n">t</span> <span class="n">a</span> <span class="n">value</span> <span class="k">for</span> <span class="n">every</span> <span class="n">combination</span> <span class="n">of</span> <span class="n">the</span> <span class="n">other</span> <span class="n">variables</span> <span class="n">and</span> <span class="n">the</span> <span class="n">key</span> 
                        <span class="n">column</span><span class="p">,</span> <span class="n">this</span> <span class="n">value</span> <span class="n">will</span> <span class="n">be</span> <span class="n">substituted</span>
        <span class="n">convert</span><span class="o">:</span>        <span class="k">if</span> <span class="n">TRUE</span> <span class="n">will</span> <span class="n">automatically</span> <span class="n">convert</span> <span class="n">values</span> <span class="n">to</span> <span class="n">logical</span><span class="p">,</span> <span class="n">integer</span><span class="p">,</span> <span class="n">numeric</span><span class="p">,</span> <span class="n">complex</span> <span class="n">or</span> 
                        <span class="n">factor</span> <span class="n">as</span> <span class="n">appropriate</span></code></pre></figure>

<p><strong>Example</strong></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">wide_DF</span> <span class="o">&lt;-</span> <span class="n">unite_DF</span> <span class="o">%&gt;%</span> <span class="n">spread</span><span class="p">(</span><span class="n">Quarter</span><span class="p">,</span> <span class="n">Revenue</span><span class="p">)</span>
<span class="n">head</span><span class="p">(</span><span class="n">wide_DF</span><span class="p">,</span> <span class="m">24</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## Source: local data frame [12 x 6]
## 
##    Group  Year Qtr.1 Qtr.2 Qtr.3 Qtr.4
##    (int) (int) (int) (int) (int) (int)
## 1      1  2006    15    16    19    17
## 2      1  2007    12    13    27    23
## 3      1  2008    22    22    24    20
## 4      1  2009    10    14    20    16
## 5      2  2006    12    13    25    18
## 6      2  2007    16    14    21    19
## 7      2  2008    13    11    29    15
## 8      2  2009    23    20    26    20
## 9      3  2006    11    12    22    16
## 10     3  2007    13    11    27    21
## 11     3  2008    17    12    23    19
## 12     3  2009    14     9    31    24</code></pre></figure>

<p><a href="#">Go to top</a></p>

<center><hr width="50%" /></center>

<p><br /></p>

<h2 id="udplyr-operationsu"><u>dplyr Operations</u></h2>

<p>There are seven fundamental functions of data transformation:</p>

<ul>
  <li><a href="#select"><code class="highlighter-rouge">select()</code></a> selecting variables</li>
  <li><a href="#filter"><code class="highlighter-rouge">filter()</code></a> provides basic filtering capabilities</li>
  <li><a href="#group"><code class="highlighter-rouge">group_by()</code></a> groups data by categorical levels</li>
  <li><a href="#summarise"><code class="highlighter-rouge">summarise()</code></a> summarise data by functions of choice</li>
  <li><a href="#arrange"><code class="highlighter-rouge">arrange()</code></a> ordering data</li>
  <li><a href="#join"><code class="highlighter-rouge">join()</code></a> joining separate dataframes</li>
  <li><a href="#mutate"><code class="highlighter-rouge">mutate()</code></a> create new variables</li>
</ul>

<p><br /></p>

<p>For these examples we’ll use the following <a href="http://www.census.gov/en.html">census data</a> which includes the K-12 public school expenditures by state.  This dataframe currently is 50x16 and includes expenditure data for 14 unique years.</p>

<p>Left half of data:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## Warning in left_join_impl(x, y, by$x, by$y): joining factor and
## character vector, coercing into character vector</code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##   Division      State   X1980    X1990    X2000    X2001    X2002
## 1        6    Alabama 1146713  2275233  4176082  4354794  4444390
## 2        9     Alaska  377947   828051  1183499  1229036  1284854
## 3        8    Arizona  949753  2258660  4288739  4846105  5395814
## 4        7   Arkansas  666949  1404545  2380331  2505179  2822877
## 5        9 California 9172158 21485782 38129479 42908787 46265544
## 6        8   Colorado 1243049  2451833  4401010  4758173  5151003
##      X2003
## 1  4657643
## 2  1326226
## 3  5892227
## 4  2923401
## 5 47983402
## 6  5551506</code></pre></figure>

<p>Right half of data:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##      X2004    X2005    X2006    X2007    X2008    X2009    X2010
## 1  4812479  5164406  5699076  6245031  6832439  6683843  6670517
## 2  1354846  1442269  1529645  1634316  1918375  2007319  2084019
## 3  6071785  6579957  7130341  7815720  8403221  8726755  8482552
## 4  3109644  3546999  3808011  3997701  4156368  4240839  4459910
## 5 49215866 50918654 53436103 57352599 61570555 60080929 58248662
## 6  5666191  5994440  6368289  6579053  7338766  7187267  7429302
##      X2011
## 1  6592925
## 2  2201270
## 3  8340211
## 4  4578136
## 5 57526835
## 6  7409462</code></pre></figure>

<p><a href="#">Go to top</a></p>

<p><br />
<a id="select"> </a></p>

<h3 id="uselect--functionu"><u>select( ) function</u>:</h3>
<p><strong>Objective:</strong> Reduce dataframe size to only desired variables for current task</p>

<p><strong>Description:</strong> When working with a sizable dataframe, often we desire to only assess specific variables.  The <code class="highlighter-rouge">select()</code> function allows you to select and/or rename variables.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">Function</span><span class="o">:</span>       <span class="n">select</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="k">...</span><span class="p">)</span>
<span class="n">Same</span> <span class="n">as</span><span class="o">:</span>        <span class="n">data</span> <span class="o">%&gt;%</span> <span class="n">select</span><span class="p">(</span><span class="k">...</span><span class="p">)</span>

<span class="n">Arguments</span><span class="o">:</span>
        <span class="n">data</span><span class="o">:</span>           <span class="n">data</span> <span class="n">frame</span>
        <span class="k">...</span><span class="o">:</span>            <span class="n">call</span> <span class="n">variables</span> <span class="n">by</span> <span class="n">name</span> <span class="n">or</span> <span class="n">by</span> <span class="k">function</span>

<span class="n">Special</span> <span class="n">functions</span><span class="o">:</span>
        <span class="n">starts_with</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ignore.case</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span><span class="o">:</span> <span class="n">names</span> <span class="n">starts</span> <span class="n">with</span> <span class="n">x</span>
        <span class="n">ends_with</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ignore.case</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span><span class="o">:</span>   <span class="n">names</span> <span class="n">ends</span> <span class="k">in</span> <span class="n">x</span>
        <span class="n">contains</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ignore.case</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span><span class="o">:</span>    <span class="n">selects</span> <span class="n">all</span> <span class="n">variables</span> <span class="n">whose</span> <span class="n">name</span> <span class="n">contains</span> <span class="n">x</span>
        <span class="n">matches</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ignore.case</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span><span class="o">:</span>     <span class="n">selects</span> <span class="n">all</span> <span class="n">variables</span> <span class="n">whose</span> <span class="n">name</span> <span class="n">matches</span> <span class="n">the</span> <span class="n">regular</span> <span class="n">expression</span> <span class="n">x</span></code></pre></figure>

<p><strong>Example</strong>
Let’s say our goal is to only assess the 5 most recent years worth of expenditure data.  Applying the <code class="highlighter-rouge">select()</code> function we can <em>select</em> only the variables of concern.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">sub.exp</span> <span class="o">&lt;-</span> <span class="n">expenditures</span> <span class="o">%&gt;%</span> <span class="n">select</span><span class="p">(</span><span class="n">Division</span><span class="p">,</span> <span class="n">State</span><span class="p">,</span> <span class="n">X2007</span><span class="o">:</span><span class="n">X2011</span><span class="p">)</span>
<span class="n">head</span><span class="p">(</span><span class="n">sub.exp</span><span class="p">)</span>  <span class="err">#</span> <span class="k">for</span> <span class="n">brevity</span> <span class="n">only</span> <span class="n">display</span> <span class="n">first</span> <span class="m">6</span> <span class="n">rows</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##   Division      State    X2007    X2008    X2009    X2010    X2011
## 1        6    Alabama  6245031  6832439  6683843  6670517  6592925
## 2        9     Alaska  1634316  1918375  2007319  2084019  2201270
## 3        8    Arizona  7815720  8403221  8726755  8482552  8340211
## 4        7   Arkansas  3997701  4156368  4240839  4459910  4578136
## 5        9 California 57352599 61570555 60080929 58248662 57526835
## 6        8   Colorado  6579053  7338766  7187267  7429302  7409462</code></pre></figure>

<p><br /></p>

<p>We can also apply some of the special functions within <code class="highlighter-rouge">select()</code>. For instance we can select all variables that start with ‘X’:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">head</span><span class="p">(</span><span class="n">expenditures</span> <span class="o">%&gt;%</span> <span class="n">select</span><span class="p">(</span><span class="n">starts_with</span><span class="p">(</span><span class="s2">"X"</span><span class="p">)))</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##     X1980    X1990    X2000    X2001    X2002    X2003    X2004
## 1 1146713  2275233  4176082  4354794  4444390  4657643  4812479
## 2  377947   828051  1183499  1229036  1284854  1326226  1354846
## 3  949753  2258660  4288739  4846105  5395814  5892227  6071785
## 4  666949  1404545  2380331  2505179  2822877  2923401  3109644
## 5 9172158 21485782 38129479 42908787 46265544 47983402 49215866
## 6 1243049  2451833  4401010  4758173  5151003  5551506  5666191
##      X2005    X2006    X2007    X2008    X2009    X2010    X2011
## 1  5164406  5699076  6245031  6832439  6683843  6670517  6592925
## 2  1442269  1529645  1634316  1918375  2007319  2084019  2201270
## 3  6579957  7130341  7815720  8403221  8726755  8482552  8340211
## 4  3546999  3808011  3997701  4156368  4240839  4459910  4578136
## 5 50918654 53436103 57352599 61570555 60080929 58248662 57526835
## 6  5994440  6368289  6579053  7338766  7187267  7429302  7409462</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">You</span> <span class="n">can</span> <span class="n">also</span> <span class="n">de</span><span class="o">-</span><span class="n">select</span> <span class="n">variables</span> <span class="n">by</span> <span class="n">using</span> <span class="s2">"-"</span> <span class="n">prior</span> <span class="n">to</span> <span class="n">name</span> <span class="n">or</span> <span class="n">function.</span>  <span class="n">The</span> <span class="n">following</span> <span class="n">produces</span> <span class="n">the</span> <span class="n">inverse</span> <span class="n">of</span> <span class="n">functions</span> <span class="n">above</span>
        <span class="n">expenditures</span> <span class="o">%&gt;%</span> <span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">X1980</span><span class="o">:-</span><span class="n">X2006</span><span class="p">)</span>
        <span class="n">expenditures</span> <span class="o">%&gt;%</span> <span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">starts_with</span><span class="p">(</span><span class="s2">"X"</span><span class="p">))</span></code></pre></figure>

<p><a href="#">Go to top</a></p>

<p><br />
<a id="filter"> </a></p>

<h3 id="ufilter--functionu"><u>filter( ) function</u>:</h3>
<p><strong>Objective:</strong> Reduce rows/observations with matching conditions</p>

<p><strong>Description:</strong> Filtering data is a common task to identify/select observations in which a particular variable matches a specific value/condition. The <code class="highlighter-rouge">filter()</code> function provides this capability.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">Function</span><span class="o">:</span>       <span class="n">filter</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="k">...</span><span class="p">)</span>
<span class="n">Same</span> <span class="n">as</span><span class="o">:</span>        <span class="n">data</span> <span class="o">%&gt;%</span> <span class="n">filter</span><span class="p">(</span><span class="k">...</span><span class="p">)</span>

<span class="n">Arguments</span><span class="o">:</span>
        <span class="n">data</span><span class="o">:</span>           <span class="n">data</span> <span class="n">frame</span>
        <span class="k">...</span><span class="o">:</span>            <span class="n">conditions</span> <span class="n">to</span> <span class="n">be</span> <span class="n">met</span></code></pre></figure>

<p><br /></p>

<p><strong>Examples</strong></p>

<p>Continuing with our <strong>sub.exp</strong> dataframe which includes only the recent 5 years worth of expenditures, we can filter by <em>Division</em>:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">sub.exp</span> <span class="o">%&gt;%</span> <span class="n">filter</span><span class="p">(</span><span class="n">Division</span> <span class="o">==</span> <span class="m">3</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##   Division     State    X2007    X2008    X2009    X2010    X2011
## 1        3  Illinois 20326591 21874484 23495271 24695773 24554467
## 2        3   Indiana  9497077  9281709  9680895  9921243  9687949
## 3        3  Michigan 17013259 17053521 17217584 17227515 16786444
## 4        3      Ohio 18251361 18892374 19387318 19801670 19988921
## 5        3 Wisconsin  9029660  9366134  9696228  9966244 10333016</code></pre></figure>

<p><br /></p>

<p>We can apply multiple logic rules in the <code class="highlighter-rouge">filter()</code> function such as:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="o">&lt;</span>   <span class="n">Less</span> <span class="n">than</span>                    <span class="o">!=</span>      <span class="n">Not</span> <span class="n">equal</span> <span class="n">to</span>
<span class="o">&gt;</span>   <span class="n">Greater</span> <span class="n">than</span>                 <span class="o">%</span><span class="k">in</span><span class="o">%</span>    <span class="n">Group</span> <span class="n">membership</span>
<span class="o">==</span>  <span class="n">Equal</span> <span class="n">to</span>                     <span class="n">is.na</span>   <span class="n">is</span> <span class="n">NA</span>
<span class="o">&lt;=</span>  <span class="n">Less</span> <span class="n">than</span> <span class="n">or</span> <span class="n">equal</span> <span class="n">to</span>        <span class="o">!</span><span class="n">is.na</span>  <span class="n">is</span> <span class="n">not</span> <span class="n">NA</span>
<span class="o">&gt;=</span>  <span class="n">Greater</span> <span class="n">than</span> <span class="n">or</span> <span class="n">equal</span> <span class="n">to</span>     <span class="o">&amp;</span><span class="p">,</span><span class="o">|</span><span class="p">,</span><span class="o">!</span>   <span class="n">Boolean</span> <span class="n">operators</span></code></pre></figure>

<p><br /></p>

<p>For instance, we can filter for Division 3 and expenditures in 2011 that were greater than $10B.  This results in Indiana, which is in Division 3, being excluded since its expenditures were &lt; $10B <em>(FYI - the raw census data are reported in units of $1,000)</em>.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">sub.exp</span> <span class="o">%&gt;%</span> <span class="n">filter</span><span class="p">(</span><span class="n">Division</span> <span class="o">==</span> <span class="m">3</span><span class="p">,</span> <span class="n">X2011</span> <span class="o">&gt;</span> <span class="m">10000000</span><span class="p">)</span>  <span class="err">#</span> <span class="n">Raw</span> <span class="n">census</span> <span class="n">data</span> <span class="n">are</span> <span class="k">in</span> <span class="n">units</span> <span class="n">of</span> <span class="o">$</span><span class="m">1</span><span class="p">,</span><span class="m">000</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##   Division     State    X2007    X2008    X2009    X2010    X2011
## 1        3  Illinois 20326591 21874484 23495271 24695773 24554467
## 2        3  Michigan 17013259 17053521 17217584 17227515 16786444
## 3        3      Ohio 18251361 18892374 19387318 19801670 19988921
## 4        3 Wisconsin  9029660  9366134  9696228  9966244 10333016</code></pre></figure>

<p><a href="#">Go to top</a></p>

<p><br />
<a id="group"> </a></p>

<h3 id="ugroupby--functionu"><u>group_by( ) function</u>:</h3>
<p><strong>Objective:</strong> Group data by categorical variables</p>

<p><strong>Description:</strong> Often, observations are nested within groups or categories and our goals is to perform statistical analysis both at the observation level and also at the group level.  The <code class="highlighter-rouge">group_by()</code> function allows us to create these categorical groupings.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">Function</span><span class="o">:</span>       <span class="n">group_by</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="k">...</span><span class="p">)</span>
<span class="n">Same</span> <span class="n">as</span><span class="o">:</span>        <span class="n">data</span> <span class="o">%&gt;%</span> <span class="n">group_by</span><span class="p">(</span><span class="k">...</span><span class="p">)</span>

<span class="n">Arguments</span><span class="o">:</span>
        <span class="n">data</span><span class="o">:</span>           <span class="n">data</span> <span class="n">frame</span>
        <span class="k">...</span><span class="o">:</span>            <span class="n">variables</span> <span class="n">to</span> <span class="n">group_by</span>

<span class="o">*</span><span class="n">Use</span> <span class="n">ungroup</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">to</span> <span class="n">remove</span> <span class="n">groups</span></code></pre></figure>

<p><br /></p>

<p><strong>Example</strong>
The <code class="highlighter-rouge">group_by()</code> function is a <em>silent</em> function in which no observable manipulation of the data is performed as a result of applying the function.  Rather, the only change you’ll notice is, if you print the dataframe you will notice underneath the <em>Source</em> information and prior to the actual dataframe, an indicator of what variable the data is grouped by will be provided. The real magic of the <code class="highlighter-rouge">group_by()</code> function comes when we perform summary statistics which we will cover shortly.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">group.exp</span> <span class="o">&lt;-</span> <span class="n">sub.exp</span> <span class="o">%&gt;%</span> <span class="n">group_by</span><span class="p">(</span><span class="n">Division</span><span class="p">)</span>

<span class="n">head</span><span class="p">(</span><span class="n">group.exp</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## Source: local data frame [6 x 7]
## Groups: Division [4]
## 
##   Division      State    X2007    X2008    X2009    X2010    X2011
##      (int)      (chr)    (int)    (int)    (int)    (int)    (int)
## 1        6    Alabama  6245031  6832439  6683843  6670517  6592925
## 2        9     Alaska  1634316  1918375  2007319  2084019  2201270
## 3        8    Arizona  7815720  8403221  8726755  8482552  8340211
## 4        7   Arkansas  3997701  4156368  4240839  4459910  4578136
## 5        9 California 57352599 61570555 60080929 58248662 57526835
## 6        8   Colorado  6579053  7338766  7187267  7429302  7409462</code></pre></figure>

<p><a href="#">Go to top</a></p>

<p><br />
<a id="summarise"> </a></p>

<h3 id="usummarise--functionu"><u>summarise( ) function</u>:</h3>
<p><strong>Objective:</strong> Perform summary statistics on variables</p>

<p><strong>Description:</strong> Obviously the goal of all this data <em>wrangling</em> is to be able to perform statistical analysis on our data.  The <code class="highlighter-rouge">summarise()</code> function allows us to perform the majority of the initial summary statistics when performing exploratory data analysis.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">Function</span><span class="o">:</span>       <span class="n">summarise</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="k">...</span><span class="p">)</span>
<span class="n">Same</span> <span class="n">as</span><span class="o">:</span>        <span class="n">data</span> <span class="o">%&gt;%</span> <span class="n">summarise</span><span class="p">(</span><span class="k">...</span><span class="p">)</span>

<span class="n">Arguments</span><span class="o">:</span>
        <span class="n">data</span><span class="o">:</span>           <span class="n">data</span> <span class="n">frame</span>
        <span class="k">...</span><span class="o">:</span>            <span class="n">Name</span><span class="o">-</span><span class="n">value</span> <span class="n">pairs</span> <span class="n">of</span> <span class="n">summary</span> <span class="n">functions</span> <span class="n">like</span> <span class="n">min</span><span class="p">(),</span> <span class="n">mean</span><span class="p">(),</span> <span class="n">max</span><span class="p">()</span> <span class="n">etc.</span>

<span class="o">*</span><span class="n">Developer</span> <span class="n">is</span> <span class="n">from</span> <span class="n">New</span> <span class="n">Zealand...can</span> <span class="n">use</span> <span class="s2">"summarise(x)"</span> <span class="n">or</span> <span class="s2">"summarize(x)"</span></code></pre></figure>

<p><br /></p>

<p><strong>Examples</strong></p>

<p>Lets get the mean expenditure value across all states in 2011</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">sub.exp</span> <span class="o">%&gt;%</span> <span class="n">summarise</span><span class="p">(</span><span class="n">Mean_2011</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">X2011</span><span class="p">))</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##   Mean_2011
## 1  10513678</code></pre></figure>

<p>Not too bad, lets get some more summary stats</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">sub.exp</span> <span class="o">%&gt;%</span> <span class="n">summarise</span><span class="p">(</span><span class="n">Min</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">X2011</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="n">TRUE</span><span class="p">),</span>
                     <span class="n">Median</span> <span class="o">=</span> <span class="n">median</span><span class="p">(</span><span class="n">X2011</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="n">TRUE</span><span class="p">),</span>
                     <span class="n">Mean</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">X2011</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="n">TRUE</span><span class="p">),</span>
                     <span class="n">Var</span> <span class="o">=</span> <span class="n">var</span><span class="p">(</span><span class="n">X2011</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="n">TRUE</span><span class="p">),</span>
                     <span class="n">SD</span> <span class="o">=</span> <span class="n">sd</span><span class="p">(</span><span class="n">X2011</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="n">TRUE</span><span class="p">),</span>
                     <span class="n">Max</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">X2011</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="n">TRUE</span><span class="p">),</span>
                     <span class="n">N</span> <span class="o">=</span> <span class="n">n</span><span class="p">())</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##       Min  Median     Mean         Var       SD      Max  N
## 1 1049772 6527404 10513678 1.48619e+14 12190938 57526835 50</code></pre></figure>

<p>This information is useful, but being able to compare summary statistics at multiple levels is when you really start to gather some insights.  This is where the <code class="highlighter-rouge">group_by()</code> function comes in.  First, let’s group by <em>Division</em> and see how the different regions compared in by 2010 and 2011.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">sub.exp</span> <span class="o">%&gt;%</span>
        <span class="n">group_by</span><span class="p">(</span><span class="n">Division</span><span class="p">)</span><span class="o">%&gt;%</span> 
        <span class="n">summarise</span><span class="p">(</span><span class="n">Mean_2010</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">X2010</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="n">TRUE</span><span class="p">),</span>
                  <span class="n">Mean_2011</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">X2011</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="n">TRUE</span><span class="p">))</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## Source: local data frame [9 x 3]
## 
##   Division Mean_2010 Mean_2011
##      (int)     (dbl)     (dbl)
## 1        1   5121003   5222277
## 2        2  32415457  32877923
## 3        3  16322489  16270159
## 4        4   4672332   4672687
## 5        5  10975194  11023526
## 6        6   6161967   6267490
## 7        7  14916843  15000139
## 8        8   3894003   3882159
## 9        9  15540681  15468173</code></pre></figure>

<p>Now we’re starting to see some differences pop out.  How about we compare states within a Division?  We can start to apply multiple functions we’ve learned so far to get the 5 year average for each state within Division 3.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">sub.exp</span> <span class="o">%&gt;%</span>
        <span class="n">gather</span><span class="p">(</span><span class="n">Year</span><span class="p">,</span> <span class="n">Expenditure</span><span class="p">,</span> <span class="n">X2007</span><span class="o">:</span><span class="n">X2011</span><span class="p">)</span> <span class="o">%&gt;%</span>   <span class="c1"># this turns our wide data to a long format
</span>        <span class="n">filter</span><span class="p">(</span><span class="n">Division</span> <span class="o">==</span> <span class="m">3</span><span class="p">)</span> <span class="o">%&gt;%</span>                    <span class="c1"># we only want to compare states within Division 3
</span>        <span class="n">group_by</span><span class="p">(</span><span class="n">State</span><span class="p">)</span> <span class="o">%&gt;%</span>                          <span class="c1"># we want to summarize data at the state level
</span>        <span class="n">summarise</span><span class="p">(</span><span class="n">Mean</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">Expenditure</span><span class="p">),</span>
                  <span class="n">SD</span> <span class="o">=</span> <span class="n">sd</span><span class="p">(</span><span class="n">Expenditure</span><span class="p">))</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## Source: local data frame [5 x 3]
## 
##       State     Mean        SD
##       (chr)    (dbl)     (dbl)
## 1  Illinois 22989317 1867527.7
## 2   Indiana  9613775  238971.6
## 3  Michigan 17059665  180245.0
## 4      Ohio 19264329  705930.2
## 5 Wisconsin  9678256  507461.2</code></pre></figure>

<p><a href="#">Go to top</a></p>

<p><br />
<a id="arrange"> </a></p>

<h3 id="uarrange--functionu"><u>arrange( ) function</u>:</h3>
<p><strong>Objective:</strong> Order variable values</p>

<p><strong>Description:</strong>  Often, we desire to view observations in rank order for a particular variable(s). The <code class="highlighter-rouge">arrange()</code> function allows us to order data by variables in accending or descending order.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">Function</span><span class="o">:</span>       <span class="n">arrange</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="k">...</span><span class="p">)</span>
<span class="n">Same</span> <span class="n">as</span><span class="o">:</span>        <span class="n">data</span> <span class="o">%&gt;%</span> <span class="n">arrange</span><span class="p">(</span><span class="k">...</span><span class="p">)</span>

<span class="n">Arguments</span><span class="o">:</span>
        <span class="n">data</span><span class="o">:</span>           <span class="n">data</span> <span class="n">frame</span>
        <span class="k">...</span><span class="o">:</span>            <span class="n">Variable</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">to</span> <span class="n">order</span>

<span class="o">*</span><span class="n">use</span> <span class="n">desc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">to</span> <span class="n">sort</span> <span class="n">variable</span> <span class="k">in</span> <span class="n">descending</span> <span class="n">order</span></code></pre></figure>

<p><br /></p>

<p><strong>Examples</strong></p>

<p>For instance, in the summarise example we compared the the mean expenditures for each division. We could apply the <code class="highlighter-rouge">arrange()</code> function at the end to order the divisions from lowest to highest expenditure for 2011.  This makes it easier to see the significant differences between Divisions 8,4,1 &amp; 6 as compared to Divisions 5,7,9,3 &amp; 2.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">sub.exp</span> <span class="o">%&gt;%</span>
        <span class="n">group_by</span><span class="p">(</span><span class="n">Division</span><span class="p">)</span><span class="o">%&gt;%</span> 
        <span class="n">summarise</span><span class="p">(</span><span class="n">Mean_2010</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">X2010</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="n">TRUE</span><span class="p">),</span>
                  <span class="n">Mean_2011</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">X2011</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="n">TRUE</span><span class="p">))</span> <span class="o">%&gt;%</span>
        <span class="n">arrange</span><span class="p">(</span><span class="n">Mean_2011</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## Source: local data frame [9 x 3]
## 
##   Division Mean_2010 Mean_2011
##      (int)     (dbl)     (dbl)
## 1        8   3894003   3882159
## 2        4   4672332   4672687
## 3        1   5121003   5222277
## 4        6   6161967   6267490
## 5        5  10975194  11023526
## 6        7  14916843  15000139
## 7        9  15540681  15468173
## 8        3  16322489  16270159
## 9        2  32415457  32877923</code></pre></figure>

<p>We can also apply an <em>descending</em> argument to rank-order from highest to lowest.  The following shows the same data but in descending order by applying <code class="highlighter-rouge">desc()</code> within the <code class="highlighter-rouge">arrange()</code> function.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">sub.exp</span> <span class="o">%&gt;%</span>
        <span class="n">group_by</span><span class="p">(</span><span class="n">Division</span><span class="p">)</span><span class="o">%&gt;%</span> 
        <span class="n">summarise</span><span class="p">(</span><span class="n">Mean_2010</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">X2010</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="n">TRUE</span><span class="p">),</span>
                  <span class="n">Mean_2011</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">X2011</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="n">TRUE</span><span class="p">))</span> <span class="o">%&gt;%</span>
        <span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">Mean_2011</span><span class="p">))</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## Source: local data frame [9 x 3]
## 
##   Division Mean_2010 Mean_2011
##      (int)     (dbl)     (dbl)
## 1        2  32415457  32877923
## 2        3  16322489  16270159
## 3        9  15540681  15468173
## 4        7  14916843  15000139
## 5        5  10975194  11023526
## 6        6   6161967   6267490
## 7        1   5121003   5222277
## 8        4   4672332   4672687
## 9        8   3894003   3882159</code></pre></figure>

<p><a href="#">Go to top</a></p>

<p><br />
<a id="join"> </a></p>

<h3 id="ujoin--functionsu"><u>join( ) functions</u>:</h3>
<p><strong>Objective:</strong> Join two datasets together</p>

<p><strong>Description:</strong> Often we have separate dataframes that can have common and differing variables for similar observations and we wish to <em>join</em> these dataframes together.  The multiple <code class="highlighter-rouge">xxx_join()</code> functions provide multiple ways to join dataframes.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">Description</span><span class="o">:</span>    <span class="n">Join</span> <span class="n">two</span> <span class="n">datasets</span>

<span class="n">Function</span><span class="o">:</span>       
                <span class="n">inner_join</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">NULL</span><span class="p">)</span>
                <span class="n">left_join</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">NULL</span><span class="p">)</span>
                <span class="n">semi_join</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">NULL</span><span class="p">)</span>
                <span class="n">anti_join</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">NULL</span><span class="p">)</span>

<span class="n">Arguments</span><span class="o">:</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">:</span>           <span class="n">data</span> <span class="n">frames</span> <span class="n">to</span> <span class="n">join</span>
        <span class="n">by</span><span class="o">:</span>            <span class="n">a</span> <span class="n">character</span> <span class="n">vector</span> <span class="n">of</span> <span class="n">variables</span> <span class="n">to</span> <span class="n">join</span> <span class="n">by.</span> <span class="n">If</span> <span class="n">NULL</span><span class="p">,</span> <span class="n">the</span> <span class="n">default</span><span class="p">,</span> <span class="n">join</span> <span class="n">will</span> <span class="n">do</span> <span class="n">a</span> <span class="n">natural</span> <span class="n">join</span><span class="p">,</span> <span class="n">using</span> <span class="n">all</span> 
                        <span class="n">variables</span> <span class="n">with</span> <span class="n">common</span> <span class="n">names</span> <span class="n">across</span> <span class="n">the</span> <span class="n">two</span> <span class="n">tables.</span></code></pre></figure>

<p><br /></p>

<p><strong>Example</strong></p>

<p>Our public education expenditure data represents then-year dollars.  To make any accurate assessments of longitudinal trends and comparison we need to adjust for inflation.  I have the following dataframe which provides inflation adjustment factors for base-year 2012 dollars <em>(obviously I should use 2014 values but I had these easily accessable and it only serves for illustrative purposes)</em>.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##    Year  Annual Inflation
## 28 2007 207.342 0.9030811
## 29 2008 215.303 0.9377553
## 30 2009 214.537 0.9344190
## 31 2010 218.056 0.9497461
## 32 2011 224.939 0.9797251
## 33 2012 229.594 1.0000000</code></pre></figure>

<p>To join to my expenditure data I obviously need to get my expenditure data in the proper form that allows my to join these two dataframes.  I can apply the following functions to accomplish this:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">long.exp</span> <span class="o">&lt;-</span> <span class="n">sub.exp</span> <span class="o">%&gt;%</span>
        <span class="n">gather</span><span class="p">(</span><span class="n">Year</span><span class="p">,</span> <span class="n">Expenditure</span><span class="p">,</span> <span class="n">X2007</span><span class="o">:</span><span class="n">X2011</span><span class="p">)</span> <span class="o">%&gt;%</span>         <span class="c1"># turn to long format
</span>        <span class="n">separate</span><span class="p">(</span><span class="n">Year</span><span class="p">,</span> <span class="n">into</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"x"</span><span class="p">,</span> <span class="s2">"Year"</span><span class="p">),</span> <span class="n">sep</span><span class="o">=</span><span class="s2">"X"</span><span class="p">)</span> <span class="o">%&gt;%</span>   <span class="c1"># separate "X" from year value
</span>        <span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>                                         <span class="c1"># remove "x" column
</span>
<span class="n">long.exp</span><span class="o">$</span><span class="n">Year</span> <span class="o">&lt;-</span> <span class="n">as.numeric</span><span class="p">(</span><span class="n">long.exp</span><span class="o">$</span> <span class="n">Year</span><span class="p">)</span>  <span class="c1"># convert from character to numeric
</span>
<span class="n">head</span><span class="p">(</span><span class="n">long.exp</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##   Division      State Year Expenditure
## 1        6    Alabama 2007     6245031
## 2        9     Alaska 2007     1634316
## 3        8    Arizona 2007     7815720
## 4        7   Arkansas 2007     3997701
## 5        9 California 2007    57352599
## 6        8   Colorado 2007     6579053</code></pre></figure>

<p>I can now apply the <code class="highlighter-rouge">left_join()</code> function to join the inflation data to the expenditure data.  This aligns the data in both dataframes by the <em>Year</em> variable and then joins the remaining inflation data to the expenditure dataframe as new variables.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">join.exp</span> <span class="o">&lt;-</span> <span class="n">long.exp</span> <span class="o">%&gt;%</span> <span class="n">left_join</span><span class="p">(</span><span class="n">inflation</span><span class="p">)</span>

<span class="n">head</span><span class="p">(</span><span class="n">join.exp</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##   Division      State Year Expenditure  Annual Inflation
## 1        6    Alabama 2007     6245031 207.342 0.9030811
## 2        9     Alaska 2007     1634316 207.342 0.9030811
## 3        8    Arizona 2007     7815720 207.342 0.9030811
## 4        7   Arkansas 2007     3997701 207.342 0.9030811
## 5        9 California 2007    57352599 207.342 0.9030811
## 6        8   Colorado 2007     6579053 207.342 0.9030811</code></pre></figure>

<p>To illustrate the other joining methods we can use these two simple dateframes:</p>

<p>Dataframe “x”:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##     name instrument
## 1   John     guitar
## 2   Paul       bass
## 3 George     guitar
## 4  Ringo      drums
## 5 Stuart       bass
## 6   Pete      drums</code></pre></figure>

<p>Dataframe “y”:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##     name  band
## 1   John  TRUE
## 2   Paul  TRUE
## 3 George  TRUE
## 4  Ringo  TRUE
## 5  Brian FALSE</code></pre></figure>

<p><br /></p>

<p><code class="highlighter-rouge">inner_join()</code>: Include only rows in both x and y that have a matching value</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">inner_join</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##     name instrument band
## 1   John     guitar TRUE
## 2   Paul       bass TRUE
## 3 George     guitar TRUE
## 4  Ringo      drums TRUE</code></pre></figure>

<p><br /></p>

<p><code class="highlighter-rouge">left_join()</code>: Include all of x, and matching rows of y</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">left_join</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##     name instrument band
## 1   John     guitar TRUE
## 2   Paul       bass TRUE
## 3 George     guitar TRUE
## 4  Ringo      drums TRUE
## 5 Stuart       bass &lt;NA&gt;
## 6   Pete      drums &lt;NA&gt;</code></pre></figure>

<p><br /></p>

<p><code class="highlighter-rouge">semi_join()</code>: Include rows of x that match y but only keep the columns from x</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">semi_join</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##     name instrument
## 1   John     guitar
## 2   Paul       bass
## 3 George     guitar
## 4  Ringo      drums</code></pre></figure>

<p><br /></p>

<p><code class="highlighter-rouge">anti_join()</code>: Opposite of semi_join</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">anti_join</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##     name instrument
## 1   Pete      drums
## 2 Stuart       bass</code></pre></figure>

<p><a href="#">Go to top</a></p>

<p><br />
<a id="mutate"> </a></p>

<h3 id="umutate--functionu"><u>mutate( ) function</u>:</h3>
<p><strong>Objective:</strong> Creates new variables</p>

<p><strong>Description:</strong> Often we want to create a new variable that is a function of the current variables in our dataframe or even just add a new variable.  The <code class="highlighter-rouge">mutate()</code> function allows us to add new variables while preserving the existing variables.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">Function</span><span class="o">:</span>       
                <span class="n">mutate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="k">...</span><span class="p">)</span>
<span class="n">Same</span> <span class="n">as</span><span class="o">:</span>        <span class="n">data</span> <span class="o">%&gt;%</span> <span class="n">mutate</span><span class="p">(</span><span class="k">...</span><span class="p">)</span>                

<span class="n">Arguments</span><span class="o">:</span>
        <span class="n">data</span><span class="o">:</span>           <span class="n">data</span> <span class="n">frame</span>
        <span class="k">...</span><span class="o">:</span>            <span class="n">Expression</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></code></pre></figure>

<p><br /></p>

<p><strong>Examples</strong></p>

<p>If we go back to our previous <strong>join.exp</strong> dataframe, remember that we joined inflation rates to our non-inflation adjusted expenditures for public schools.  The dataframe looks like:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##   Division      State Year Expenditure  Annual Inflation
## 1        6    Alabama 2007     6245031 207.342 0.9030811
## 2        9     Alaska 2007     1634316 207.342 0.9030811
## 3        8    Arizona 2007     7815720 207.342 0.9030811
## 4        7   Arkansas 2007     3997701 207.342 0.9030811
## 5        9 California 2007    57352599 207.342 0.9030811
## 6        8   Colorado 2007     6579053 207.342 0.9030811</code></pre></figure>

<p>If we wanted to adjust our annual expenditures for inflation we can use <code class="highlighter-rouge">mutate()</code> to create a new inflation adjusted cost variable which we’ll name <em>Adj_Exp</em>:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">inflation_adj</span> <span class="o">&lt;-</span> <span class="n">join.exp</span> <span class="o">%&gt;%</span> <span class="n">mutate</span><span class="p">(</span><span class="n">Adj_Exp</span> <span class="o">=</span> <span class="n">Expenditure</span><span class="o">/</span><span class="n">Inflation</span><span class="p">)</span>

<span class="n">head</span><span class="p">(</span><span class="n">inflation_adj</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##   Division      State Year Expenditure  Annual Inflation  Adj_Exp
## 1        6    Alabama 2007     6245031 207.342 0.9030811  6915249
## 2        9     Alaska 2007     1634316 207.342 0.9030811  1809711
## 3        8    Arizona 2007     7815720 207.342 0.9030811  8654505
## 4        7   Arkansas 2007     3997701 207.342 0.9030811  4426735
## 5        9 California 2007    57352599 207.342 0.9030811 63507696
## 6        8   Colorado 2007     6579053 207.342 0.9030811  7285119</code></pre></figure>

<p>Lets say we wanted to create a variable that rank-orders state-level expenditures (inflation adjusted) for the year 2010 from the highest level of expenditures to the lowest.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">rank_exp</span> <span class="o">&lt;-</span> <span class="n">inflation_adj</span> <span class="o">%&gt;%</span> 
        <span class="n">filter</span><span class="p">(</span><span class="n">Year</span> <span class="o">==</span> <span class="m">2010</span><span class="p">)</span> <span class="o">%&gt;%</span>
        <span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">Adj_Exp</span><span class="p">))</span> <span class="o">%&gt;%</span>
        <span class="n">mutate</span><span class="p">(</span><span class="n">Rank</span> <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="n">length</span><span class="p">(</span><span class="n">Adj_Exp</span><span class="p">))</span>

<span class="n">head</span><span class="p">(</span><span class="n">rank_exp</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##   Division      State Year Expenditure  Annual Inflation  Adj_Exp
## 1        9 California 2010    58248662 218.056 0.9497461 61330774
## 2        2   New York 2010    50251461 218.056 0.9497461 52910417
## 3        7      Texas 2010    42621886 218.056 0.9497461 44877138
## 4        3   Illinois 2010    24695773 218.056 0.9497461 26002501
## 5        2 New Jersey 2010    24261392 218.056 0.9497461 25545135
## 6        5    Florida 2010    23349314 218.056 0.9497461 24584797
##   Rank
## 1    1
## 2    2
## 3    3
## 4    4
## 5    5
## 6    6</code></pre></figure>

<p>If you wanted to assess the percent change in cost for a particular state you can use the <code class="highlighter-rouge">lag()</code> function within the <code class="highlighter-rouge">mutate()</code> function:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">inflation_adj</span> <span class="o">%&gt;%</span>
        <span class="n">filter</span><span class="p">(</span><span class="n">State</span> <span class="o">==</span> <span class="s2">"Ohio"</span><span class="p">)</span> <span class="o">%&gt;%</span>
        <span class="n">mutate</span><span class="p">(</span><span class="n">Perc_Chg</span> <span class="o">=</span> <span class="p">(</span><span class="n">Adj_Exp</span><span class="o">-</span><span class="n">lag</span><span class="p">(</span><span class="n">Adj_Exp</span><span class="p">))</span><span class="o">/</span><span class="n">lag</span><span class="p">(</span><span class="n">Adj_Exp</span><span class="p">))</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##   Division State Year Expenditure  Annual Inflation  Adj_Exp
## 1        3  Ohio 2007    18251361 207.342 0.9030811 20210102
## 2        3  Ohio 2008    18892374 215.303 0.9377553 20146378
## 3        3  Ohio 2009    19387318 214.537 0.9344190 20747992
## 4        3  Ohio 2010    19801670 218.056 0.9497461 20849436
## 5        3  Ohio 2011    19988921 224.939 0.9797251 20402582
##       Perc_Chg
## 1           NA
## 2 -0.003153057
## 3  0.029862103
## 4  0.004889357
## 5 -0.021432441</code></pre></figure>

<p>You could also look at what percent of all US expenditures each state made up in 2011.  In this case we use <code class="highlighter-rouge">mutate()</code> to take each state’s inflation adjusted expenditure and divide by the sum of the entire inflation adjusted expenditure column.  We also apply a second function within <code class="highlighter-rouge">mutate()</code> that provides the cummalative percent in rank-order.  This shows that in 2011, the top 8 states with the highest expenditures represented over 50% of the total U.S. expenditures in K-12 public schools.  <em>(I remove the non-inflation adjusted Expenditure, Annual &amp; Inflation columns so that the columns don’t wrap on the screen view)</em></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">perc.of.whole</span> <span class="o">&lt;-</span> <span class="n">inflation_adj</span> <span class="o">%&gt;%</span>
        <span class="n">filter</span><span class="p">(</span><span class="n">Year</span> <span class="o">==</span> <span class="m">2011</span><span class="p">)</span> <span class="o">%&gt;%</span>
        <span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">Adj_Exp</span><span class="p">))</span> <span class="o">%&gt;%</span>
        <span class="n">mutate</span><span class="p">(</span><span class="n">Perc_of_Total</span> <span class="o">=</span> <span class="n">Adj_Exp</span><span class="o">/</span><span class="n">sum</span><span class="p">(</span><span class="n">Adj_Exp</span><span class="p">),</span>
               <span class="n">Cum_Perc</span> <span class="o">=</span> <span class="n">cumsum</span><span class="p">(</span><span class="n">Perc_of_Total</span><span class="p">))</span> <span class="o">%&gt;%</span>
        <span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">Expenditure</span><span class="p">,</span> <span class="o">-</span><span class="n">Annual</span><span class="p">,</span> <span class="o">-</span><span class="n">Inflation</span><span class="p">)</span>
        
<span class="n">head</span><span class="p">(</span><span class="n">perc.of.whole</span><span class="p">,</span> <span class="m">8</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##   Division        State Year  Adj_Exp Perc_of_Total  Cum_Perc
## 1        9   California 2011 58717324    0.10943237 0.1094324
## 2        2     New York 2011 52575244    0.09798528 0.2074177
## 3        7        Texas 2011 43751346    0.08154005 0.2889577
## 4        3     Illinois 2011 25062609    0.04670957 0.3356673
## 5        5      Florida 2011 24364070    0.04540769 0.3810750
## 6        2   New Jersey 2011 24128484    0.04496862 0.4260436
## 7        2 Pennsylvania 2011 23971218    0.04467552 0.4707191
## 8        3         Ohio 2011 20402582    0.03802460 0.5087437</code></pre></figure>

<p><a href="#">Go to top</a></p>

<p><br /></p>

<center><hr width="50%" /></center>

<p><br /></p>

<h2 id="uadditional-resourcesu"><u>Additional Resources</u></h2>
<p>This tutorial simply touches on the basics that these two packages can do. There are several other resources you can check out to learn more.  In addition, much of what I have learned and, therefore, much of the content in this tutorial is simply a modified regurgitation of the wonderful resources provided by <a href="http://www.rstudio.com/">R Studio</a>, <a href="https://twitter.com/hadleywickham">Hadley Wickham</a>, and <a href="https://twitter.com/StatGarrett">Garrett Grolemund</a>.</p>

<ul>
  <li>R Studio’s <a href="http://www.rstudio.com/resources/webinars/">Data wrangling with R and RStudio webinar</a></li>
  <li>R Studio’s <a href="https://github.com/rstudio/webinars/blob/master/2015-01/wrangling-webinar.pdf">Data wrangling GitHub repository</a></li>
  <li>R Studio’s <a href="http://www.rstudio.com/resources/cheatsheets/">Data wrangling cheat sheet</a></li>
  <li>Hadley Wickham’s dplyr tutorial at useR! 2014, <a href="http://www.r-bloggers.com/hadley-wickhams-dplyr-tutorial-at-user-2014-part-1/">Part 1</a></li>
  <li>Hadley Wickham’s dplyr tutorial at useR! 2014, <a href="http://www.r-bloggers.com/hadley-wickhams-dplyr-tutorial-at-user-2014-part-2/">Part 2</a></li>
  <li>Hadley Wickham’s paper on <a href="http://vita.had.co.nz/papers/tidy-data.html">Tidy Data</a></li>
</ul>

<p><br /></p>

<p><a href="#">Go to top</a></p>

<p><br /></p>

<p><em><font size="2">Special thanks to Tom Filloon and Jason Freels for providing constructive comments while developing this tutorial.</font></em></p>

  </article>

</div>





      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">

      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
        <center>
          <li>
            <a href="https://github.com/bradleyboehmke">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>
            </a>
            &nbsp;
            <a href="http://www.twitter.com/bradleyboehmke">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>
            </a>
            &nbsp;
            <a href="https://www.linkedin.com/in/brad-boehmke-ph-d-9b0a257">
              <span class="icon  icon--linkedin">
                <svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"  width="25" height="25" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path fill="#828282" d="M13.632 13.635h-2.37V9.922c0-.886-.018-2.025-1.234-2.025-1.235 0-1.424.964-1.424 1.96v3.778h-2.37V6H8.51V7.04h.03c.318-.6 1.092-1.233 2.247-1.233 2.4 0 2.845 1.58 2.845 3.637v4.188zM3.558 4.955c-.762 0-1.376-.617-1.376-1.377 0-.758.614-1.375 1.376-1.375.76 0 1.376.617 1.376 1.375 0 .76-.617 1.377-1.376 1.377zm1.188 8.68H2.37V6h2.376v7.635zM14.816 0H1.18C.528 0 0 .516 0 1.153v13.694C0 15.484.528 16 1.18 16h13.635c.652 0 1.185-.516 1.185-1.153V1.153C16 .516 15.467 0 14.815 0z" fill-rule="nonzero"/>
                </svg>
              </span>
            </a>
          </li>

        </ul>
        </center>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text"></p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
