<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>R Programming @ UC</title>
    <meta name="description" content="">

    <link rel="stylesheet" href="http://r-uc.github.io//css/main.css">
    <link rel="canonical" href="http://r-uc.github.io/http://r-uc.github.io//tutorials/scraping_data_html_tables">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="http://r-uc.github.io/">R Programming @ UC</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="http://r-uc.github.io//404">404 - Page not found</a>
          
        
          
          <a class="page-link" href="http://r-uc.github.io//about/">About</a>
          
        
          
        
          
        
          
        
          
          <a class="page-link" href="http://r-uc.github.io//categoryview/">Archive</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
          <a class="page-link" href="http://r-uc.github.io//cv/">CV</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
          <a class="page-link" href="http://r-uc.github.io//tutorials/">Tutorials</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
          <a class="page-link" href="http://r-uc.github.io//tutorials/scraping_with_apis_DSCOE.Rmd">Scraping Data with APIs</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <article class="post-content">
    <p><a href="index">R Vocab Topics</a> » <a href="data_inputs_outputs">Importing, Scraping, and exporting data</a> » <a href="scraping_data">Scraping data</a> » Scraping HTML table data</p>

<p><br /></p>

<p>In this tutorial I cover how to scrape data from another common structure of data storage on the Web - HTML tables. This tutorial reiterates some of the information from the <a href="scraping_data_html_text">previous tutorial</a>; however, we focus solely on scraping data from HTML tables. The simplest approach to scraping HTML table data directly into R is by using either the <a href="#rvest"><code class="highlighter-rouge">rvest</code> package</a> or the <a href="#xml"><code class="highlighter-rouge">XML</code> package</a>.    To illustrate, I will focus on the <a href="http://www.bls.gov/web/empsit/cesbmart.htm">BLS employment statistics webpage</a> which contains multiple HTML tables from which we can scrape data.</p>

<p><br /></p>

<p><a name="rvest"></a></p>

<h2 id="scraping-html-tables-with-rvest">Scraping HTML tables with rvest</h2>

<p>Recall that HTML elements are written with a start tag, an end tag, and with the content in between: <code class="highlighter-rouge">&lt;tagname&gt;content&lt;/tagname&gt;</code>. HTML tables are contained within <code class="highlighter-rouge">&lt;table&gt;</code> tags; therefore, to extract the tables from the BLS employment statistics webpage we first use the <code class="highlighter-rouge">html_nodes()</code> function to select the <code class="highlighter-rouge">&lt;table&gt;</code> nodes.  In this case we are interested in all table nodes that exist on the webpage. In this example, <code class="highlighter-rouge">html_nodes</code> captures 15 HTML tables. This includes data from the 10 data tables seen on the webpage but also includes data from a few additional tables used to format parts of the page (i.e. table of contents, table of figures, advertisements).</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">rvest</span><span class="p">)</span>

<span class="n">webpage</span> <span class="o">&lt;-</span> <span class="n">read_html</span><span class="p">(</span><span class="s2">"http://www.bls.gov/web/empsit/cesbmart.htm"</span><span class="p">)</span>

<span class="n">tbls</span> <span class="o">&lt;-</span> <span class="n">html_nodes</span><span class="p">(</span><span class="n">webpage</span><span class="p">,</span> <span class="s2">"table"</span><span class="p">)</span>

<span class="n">head</span><span class="p">(</span><span class="n">tbls</span><span class="p">)</span>
<span class="c1">## {xml_nodeset (6)}
## [1] &lt;table id="main-content-table"&gt;&amp;#13;\n\t&lt;tr&gt;&amp;#13;\n\t\t&lt;td id="secon ...
## [2] &lt;table id="Table1" class="regular" cellspacing="0" cellpadding="0" x ...
## [3] &lt;table id="Table2" class="regular" cellspacing="0" cellpadding="0" x ...
## [4] &lt;table id="Table3" class="regular" cellspacing="0" cellpadding="0" x ...
## [5] &lt;table id="Table4" class="regular" cellspacing="0" cellpadding="0" x ...
</span><span class="err">##</span> <span class="p">[</span><span class="m">6</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">table</span> <span class="n">id</span><span class="o">=</span><span class="s2">"Exhibit1"</span> <span class="n">class</span><span class="o">=</span><span class="s2">"regular"</span> <span class="n">cellspacing</span><span class="o">=</span><span class="s2">"0"</span> <span class="n">cellpadding</span><span class="o">=</span><span class="s2">"0"</span> <span class="k">...</span></code></pre></figure>

<p>Remember that <code class="highlighter-rouge">html_nodes()</code> does not parse the data; rather, it acts as a CSS selector. To parse the HTML table data we use <code class="highlighter-rouge">html_table()</code>, which would create a list containing 15 data frames.  However, rarely do we need to scrape <em>every</em> HTML table from a page, especially since some HTML tables don’t catch any information we are likely interested in (i.e. table of contents, table of figures, footers).</p>

<p>More often than not we want to parse specific tables. Lets assume we want to parse the second and third tables on the webpage:</p>

<ol>
  <li>Table 2. Nonfarm employment benchmarks by industry, March 2014 (in thousands) and</li>
  <li>Table 3. Net birth/death estimates by industry supersector, April – December 2014 (in thousands)</li>
</ol>

<p>This can be accomplished two ways. First, we can assess the previous <code class="highlighter-rouge">tbls</code> list and try to identify the table(s) of interest. In this example it appears that <code class="highlighter-rouge">tbls</code> list items 3 and 4 correspond with Table 2 and Table 3, respectively. We can then subset the list of table nodes prior to parsing the data with <code class="highlighter-rouge">html_table()</code>. This results in a list of two data frames containing the data of interest.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">tbls_ls</span> <span class="o">&lt;-</span> <span class="n">webpage</span> <span class="o">%&gt;%</span>
        <span class="n">html_nodes</span><span class="p">(</span><span class="s2">"table"</span><span class="p">)</span> <span class="o">%&gt;%</span>
        <span class="err">.</span><span class="p">[</span><span class="m">3</span><span class="o">:</span><span class="m">4</span><span class="p">]</span> <span class="o">%&gt;%</span>
        <span class="n">html_table</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span>

<span class="n">str</span><span class="p">(</span><span class="n">tbls_ls</span><span class="p">)</span>
<span class="c1">## List of 2
##  $ :'data.frame':	147 obs. of  6 variables:
##   ..$ CES Industry Code : chr [1:147] "Amount" "00-000000" "05-000000" "06-000000" ...
##   ..$ CES Industry Title: chr [1:147] "Percent" "Total nonfarm" "Total private" "Goods-producing" ...
##   ..$ Benchmark         : chr [1:147] NA "137,214" "114,989" "18,675" ...
##   ..$ Estimate          : chr [1:147] NA "137,147" "114,884" "18,558" ...
##   ..$ Differences       : num [1:147] NA 67 105 117 -50 -12 -16 -2.8 -13.2 -13.5 ...
##   ..$ NA                : chr [1:147] NA "(1)" "0.1" "0.6" ...
##  $ :'data.frame':	11 obs. of  12 variables:
##   ..$ CES Industry Code : chr [1:11] "10-000000" "20-000000" "30-000000" "40-000000" ...
##   ..$ CES Industry Title: chr [1:11] "Mining and logging" "Construction" "Manufacturing" "Trade, transportation, and utilities" ...
##   ..$ Apr               : int [1:11] 2 35 0 21 0 8 81 22 82 12 ...
##   ..$ May               : int [1:11] 2 37 6 24 5 8 22 13 81 6 ...
##   ..$ Jun               : int [1:11] 2 24 4 12 0 4 5 -14 86 6 ...
##   ..$ Jul               : int [1:11] 2 12 -3 7 -1 3 35 7 62 -2 ...
##   ..$ Aug               : int [1:11] 1 12 4 14 3 4 19 21 23 3 ...
##   ..$ Sep               : int [1:11] 1 7 1 9 -1 -1 -12 12 -33 -2 ...
##   ..$ Oct               : int [1:11] 1 12 3 28 6 16 76 35 -17 4 ...
##   ..$ Nov               : int [1:11] 1 -10 2 10 3 3 14 14 -22 1 ...
##   ..$ Dec               : int [1:11] 0 -21 0 4 0 10 -10 -3 4 1 ...
</span><span class="err">##</span>   <span class="err">..</span><span class="o">$</span> <span class="n">CumulativeTotal</span>   <span class="o">:</span> <span class="n">int</span> <span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">11</span><span class="p">]</span> <span class="m">12</span> <span class="m">108</span> <span class="m">17</span> <span class="m">129</span> <span class="m">15</span> <span class="m">55</span> <span class="m">230</span> <span class="m">107</span> <span class="m">266</span> <span class="m">29</span> <span class="k">...</span></code></pre></figure>

<p>An alternative approach, which is more explicit, is to use the <a href="scraping_data_html_text#specific_nodes">element selector process described in the text scraping tutorial</a> to call the table ID name.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># empty list to add table data to
</span><span class="n">tbls2_ls</span> <span class="o">&lt;-</span> <span class="n">list</span><span class="p">()</span>

<span class="c1"># scrape Table 2. Nonfarm employment...
</span><span class="n">tbls2_ls</span><span class="o">$</span><span class="n">Table1</span> <span class="o">&lt;-</span> <span class="n">webpage</span> <span class="o">%&gt;%</span>
        <span class="n">html_nodes</span><span class="p">(</span><span class="s2">"#Table2"</span><span class="p">)</span> <span class="o">%&gt;%</span> 
        <span class="n">html_table</span><span class="p">(</span><span class="n">fill</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span> <span class="o">%&gt;%</span>
        <span class="err">.</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span>

<span class="c1"># Table 3. Net birth/death...
</span><span class="n">tbls2_ls</span><span class="o">$</span><span class="n">Table2</span> <span class="o">&lt;-</span> <span class="n">webpage</span> <span class="o">%&gt;%</span>
        <span class="n">html_nodes</span><span class="p">(</span><span class="s2">"#Table3"</span><span class="p">)</span> <span class="o">%&gt;%</span> 
        <span class="n">html_table</span><span class="p">()</span> <span class="o">%&gt;%</span>
        <span class="err">.</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span>

<span class="n">str</span><span class="p">(</span><span class="n">tbls2_ls</span><span class="p">)</span>
<span class="c1">## List of 2
##  $ Table1:'data.frame':	147 obs. of  6 variables:
##   ..$ CES Industry Code : chr [1:147] "Amount" "00-000000" "05-000000" "06-000000" ...
##   ..$ CES Industry Title: chr [1:147] "Percent" "Total nonfarm" "Total private" "Goods-producing" ...
##   ..$ Benchmark         : chr [1:147] NA "137,214" "114,989" "18,675" ...
##   ..$ Estimate          : chr [1:147] NA "137,147" "114,884" "18,558" ...
##   ..$ Differences       : num [1:147] NA 67 105 117 -50 -12 -16 -2.8 -13.2 -13.5 ...
##   ..$ NA                : chr [1:147] NA "(1)" "0.1" "0.6" ...
##  $ Table2:'data.frame':	11 obs. of  12 variables:
##   ..$ CES Industry Code : chr [1:11] "10-000000" "20-000000" "30-000000" "40-000000" ...
##   ..$ CES Industry Title: chr [1:11] "Mining and logging" "Construction" "Manufacturing" "Trade, transportation, and utilities" ...
##   ..$ Apr               : int [1:11] 2 35 0 21 0 8 81 22 82 12 ...
##   ..$ May               : int [1:11] 2 37 6 24 5 8 22 13 81 6 ...
##   ..$ Jun               : int [1:11] 2 24 4 12 0 4 5 -14 86 6 ...
##   ..$ Jul               : int [1:11] 2 12 -3 7 -1 3 35 7 62 -2 ...
##   ..$ Aug               : int [1:11] 1 12 4 14 3 4 19 21 23 3 ...
##   ..$ Sep               : int [1:11] 1 7 1 9 -1 -1 -12 12 -33 -2 ...
##   ..$ Oct               : int [1:11] 1 12 3 28 6 16 76 35 -17 4 ...
##   ..$ Nov               : int [1:11] 1 -10 2 10 3 3 14 14 -22 1 ...
##   ..$ Dec               : int [1:11] 0 -21 0 4 0 10 -10 -3 4 1 ...
</span><span class="err">##</span>   <span class="err">..</span><span class="o">$</span> <span class="n">CumulativeTotal</span>   <span class="o">:</span> <span class="n">int</span> <span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">11</span><span class="p">]</span> <span class="m">12</span> <span class="m">108</span> <span class="m">17</span> <span class="m">129</span> <span class="m">15</span> <span class="m">55</span> <span class="m">230</span> <span class="m">107</span> <span class="m">266</span> <span class="m">29</span> <span class="k">...</span></code></pre></figure>

<p>One issue to note is when using <code class="highlighter-rouge">rvest</code>’s <code class="highlighter-rouge">html_table()</code> to read a table with split column headings as in <em>Table 2. Nonfarm employment…</em>.  <code class="highlighter-rouge">html_table</code> will cause split headings to be included and can cause the first row to include parts of the headings.  We can see this with Table 2.  This requires a little clean up.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">head</span><span class="p">(</span><span class="n">tbls2_ls</span><span class="p">[[</span><span class="m">1</span><span class="p">]],</span> <span class="m">4</span><span class="p">)</span>
<span class="c1">##   CES Industry Code CES Industry Title Benchmark Estimate Differences   NA
## 1            Amount            Percent      &lt;NA&gt;     &lt;NA&gt;          NA &lt;NA&gt;
## 2         00-000000      Total nonfarm   137,214  137,147          67  (1)
## 3         05-000000      Total private   114,989  114,884         105  0.1
## 4         06-000000    Goods-producing    18,675   18,558         117  0.6
</span>
<span class="c1"># remove row 1 that includes part of the headings
</span><span class="n">tbls2_ls</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span> <span class="o">&lt;-</span> <span class="n">tbls2_ls</span><span class="p">[[</span><span class="m">1</span><span class="p">]][</span><span class="m">-1</span><span class="p">,]</span>

<span class="c1"># rename table headings
</span><span class="n">colnames</span><span class="p">(</span><span class="n">tbls2_ls</span><span class="p">[[</span><span class="m">1</span><span class="p">]])</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="s2">"CES_Code"</span><span class="p">,</span> <span class="s2">"Ind_Title"</span><span class="p">,</span> <span class="s2">"Benchmark"</span><span class="p">,</span>
                            <span class="s2">"Estimate"</span><span class="p">,</span> <span class="s2">"Amt_Diff"</span><span class="p">,</span> <span class="s2">"Pct_Diff"</span><span class="p">)</span>

<span class="n">head</span><span class="p">(</span><span class="n">tbls2_ls</span><span class="p">[[</span><span class="m">1</span><span class="p">]],</span> <span class="m">4</span><span class="p">)</span>
<span class="c1">##    CES_Code         Ind_Title Benchmark Estimate Amt_Diff Pct_Diff
## 2 00-000000     Total nonfarm   137,214  137,147       67      (1)
## 3 05-000000     Total private   114,989  114,884      105      0.1
## 4 06-000000   Goods-producing    18,675   18,558      117      0.6
</span><span class="err">##</span> <span class="m">5</span> <span class="m">07-000000</span> <span class="n">Service</span><span class="o">-</span><span class="n">providing</span>   <span class="m">118</span><span class="p">,</span><span class="m">539</span>  <span class="m">118</span><span class="p">,</span><span class="m">589</span>      <span class="m">-50</span>      <span class="p">(</span><span class="m">1</span><span class="p">)</span></code></pre></figure>

<p><br /></p>

<p><a name="xml"></a></p>

<h2 id="scraping-html-tables-with-xml">Scraping HTML tables with XML</h2>
<p>An alternative to <code class="highlighter-rouge">rvest</code> for table scraping is to use the <a href="https://cran.r-project.org/web/packages/XML/index.html"><code class="highlighter-rouge">XML</code></a> package. The XML package provides a convenient <code class="highlighter-rouge">readHTMLTable()</code> function to extract data from HTML tables in HTML documents.  By passing the URL to <code class="highlighter-rouge">readHTMLTable()</code>, the data in each table is read and stored as a data frame.  In a situation like our running example where multiple tables exists, the data frames will be stored in a list similar to <code class="highlighter-rouge">rvest</code>’s <code class="highlighter-rouge">html_table</code>.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">XML</span><span class="p">)</span>

<span class="n">url</span> <span class="o">&lt;-</span> <span class="s2">"http://www.bls.gov/web/empsit/cesbmart.htm"</span>

<span class="c1"># read in HTML data
</span><span class="n">tbls_xml</span> <span class="o">&lt;-</span> <span class="n">readHTMLTable</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="n">typeof</span><span class="p">(</span><span class="n">tbls_xml</span><span class="p">)</span>
<span class="c1">## [1] "list"
</span>
<span class="n">length</span><span class="p">(</span><span class="n">tbls_xml</span><span class="p">)</span>
<span class="err">##</span> <span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">15</span></code></pre></figure>

<p>You can see that <code class="highlighter-rouge">tbls_xml</code> captures the same 15 <code class="highlighter-rouge">&lt;table&gt;</code> nodes that <code class="highlighter-rouge">html_nodes</code> captured. To capture the same tables of interest we previously discussed (<em>Table 2. Nonfarm employment…</em> and <em>Table 3. Net birth/death…</em>) we can use a couple approaches. First, we can assess <code class="highlighter-rouge">str(tbls_xml)</code> to identify the tables of interest and perform normal <a href="list#subsetting">list subsetting</a>. In our example list items 3 and 4 correspond with our tables of interest.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">head</span><span class="p">(</span><span class="n">tbls_xml</span><span class="p">[[</span><span class="m">3</span><span class="p">]])</span>
<span class="c1">##          V1                        V2      V3      V4  V5   V6
## 1 00-000000             Total nonfarm 137,214 137,147  67  (1)
## 2 05-000000             Total private 114,989 114,884 105  0.1
## 3 06-000000           Goods-producing  18,675  18,558 117  0.6
## 4 07-000000         Service-providing 118,539 118,589 -50  (1)
## 5 08-000000 Private service-providing  96,314  96,326 -12  (1)
## 6 10-000000        Mining and logging     868     884 -16 -1.8
</span>
<span class="n">head</span><span class="p">(</span><span class="n">tbls_xml</span><span class="p">[[</span><span class="m">4</span><span class="p">]],</span> <span class="m">3</span><span class="p">)</span>
<span class="c1">##   CES Industry Code CES Industry Title Apr May Jun Jul Aug Sep Oct Nov Dec   CumulativeTotal
## 1         10-000000 Mining and logging   2   2   2   2   1   1   1   1   0                12
## 2         20-000000       Construction  35  37  24  12  12   7  12 -10 -21               108
</span><span class="err">##</span> <span class="m">3</span>         <span class="m">30-000000</span>      <span class="n">Manufacturing</span>   <span class="m">0</span>   <span class="m">6</span>   <span class="m">4</span>  <span class="m">-3</span>   <span class="m">4</span>   <span class="m">1</span>   <span class="m">3</span>   <span class="m">2</span>   <span class="m">0</span>                <span class="m">17</span></code></pre></figure>

<p>Second, we can use the <code class="highlighter-rouge">which</code> argument in <code class="highlighter-rouge">readHTMLTable()</code> which restricts the data importing to only those tables specified numerically.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># only parse the 3rd and 4th tables
</span><span class="n">emp_ls</span> <span class="o">&lt;-</span> <span class="n">readHTMLTable</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">which</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">))</span>

<span class="n">str</span><span class="p">(</span><span class="n">emp_ls</span><span class="p">)</span>
<span class="c1">## List of 2
##  $ Table2:'data.frame':	145 obs. of  6 variables:
##   ..$ V1: Factor w/ 145 levels "00-000000","05-000000",..: 1 2 3 4 5 6 7 8 9 10 ...
##   ..$ V2: Factor w/ 143 levels "Accommodation",..: 130 131 52 116 102 74 67 73 90 75 ...
##   ..$ V3: Factor w/ 145 levels "1,010.3","1,048.3",..: 40 35 48 37 145 140 109 135 51 65 ...
##   ..$ V4: Factor w/ 145 levels "1,008.4","1,052.3",..: 41 34 48 36 144 142 109 136 66 65 ...
##   ..$ V5: Factor w/ 123 levels "-0.3","-0.4",..: 113 68 71 48 9 19 29 11 12 43 ...
##   ..$ V6: Factor w/ 56 levels "-0.1","-0.2",..: 30 31 36 30 30 16 28 14 29 22 ...
##  $ Table3:'data.frame':	11 obs. of  12 variables:
##   ..$ CES Industry Code : Factor w/ 11 levels "10-000000","20-000000",..: 1 2 3 4 5 6 7 8 9 10 ...
##   ..$ CES Industry Title: Factor w/ 11 levels "263","Construction",..: 8 2 7 11 5 4 10 3 6 9 ...
##   ..$ Apr               : Factor w/ 10 levels "0","12","2","204",..: 3 7 1 5 1 8 9 6 10 2 ...
##   ..$ May               : Factor w/ 10 levels "129","13","2",..: 3 6 8 5 7 9 4 2 10 8 ...
##   ..$ Jun               : Factor w/ 10 levels "-14","0","12",..: 5 6 7 3 2 7 8 1 10 9 ...
##   ..$ Jul               : Factor w/ 10 levels "-1","-2","-3",..: 6 5 3 10 1 7 8 10 9 2 ...
##   ..$ Aug               : Factor w/ 9 levels "-19","1","12",..: 2 3 9 4 8 9 5 6 7 8 ...
##   ..$ Sep               : Factor w/ 9 levels "-1","-12","-2",..: 5 8 5 9 1 1 2 6 4 3 ...
##   ..$ Oct               : Factor w/ 10 levels "-17","1","12",..: 2 3 6 5 9 4 10 7 1 8 ...
##   ..$ Nov               : Factor w/ 8 levels "-10","-15","-22",..: 4 1 7 5 8 8 6 6 3 4 ...
##   ..$ Dec               : Factor w/ 8 levels "-10","-21","-3",..: 4 2 4 7 4 6 1 3 7 5 ...
</span><span class="err">##</span>   <span class="err">..</span><span class="o">$</span> <span class="n">CumulativeTotal</span>   <span class="o">:</span> <span class="n">Factor</span> <span class="n">w</span><span class="o">/</span> <span class="m">10</span> <span class="n">levels</span> <span class="s2">"107"</span><span class="p">,</span><span class="s2">"108"</span><span class="p">,</span><span class="s2">"12"</span><span class="p">,</span><span class="err">..</span><span class="o">:</span> <span class="m">3</span> <span class="m">2</span> <span class="m">6</span> <span class="m">4</span> <span class="m">5</span> <span class="m">10</span> <span class="m">7</span> <span class="m">1</span> <span class="m">8</span> <span class="m">9</span> <span class="k">...</span></code></pre></figure>

<p>The third option involves explicitly naming the tables to parse.  This process uses the <a href="scraping_data_html_text#specific_nodes">element selector process described in the text scraping tutorial</a> to call the table by name. We use <code class="highlighter-rouge">getNodeSet()</code> to select the specified tables of interest. However, a key difference here is rather than copying the table ID names you want to copy the XPath.  You can do this with the following: After you’ve highlighted the table element of interest with the element selector, right click the highlighted element in the developer tools window and select Copy XPath. From here we just use <code class="highlighter-rouge">readHTMLTable()</code> to convert to data frames and we have our desired tables.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">RCurl</span><span class="p">)</span>

<span class="c1"># parse url
</span><span class="n">url_parsed</span> <span class="o">&lt;-</span> <span class="n">htmlParse</span><span class="p">(</span><span class="n">getURL</span><span class="p">(</span><span class="n">url</span><span class="p">),</span> <span class="n">asText</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span>

<span class="c1"># select table nodes of interest
</span><span class="n">tableNodes</span> <span class="o">&lt;-</span> <span class="n">getNodeSet</span><span class="p">(</span><span class="n">url_parsed</span><span class="p">,</span> <span class="n">c</span><span class="p">(</span><span class="s1">'//*[@id="Table2"]'</span><span class="p">,</span> <span class="s1">'//*[@id="Table3"]'</span><span class="p">))</span>

<span class="c1"># convert HTML tables to data frames
</span><span class="n">bls_table2</span> <span class="o">&lt;-</span> <span class="n">readHTMLTable</span><span class="p">(</span><span class="n">tableNodes</span><span class="p">[[</span><span class="m">1</span><span class="p">]])</span>
<span class="n">bls_table3</span> <span class="o">&lt;-</span> <span class="n">readHTMLTable</span><span class="p">(</span><span class="n">tableNodes</span><span class="p">[[</span><span class="m">2</span><span class="p">]])</span>

<span class="n">head</span><span class="p">(</span><span class="n">bls_table2</span><span class="p">)</span>
<span class="c1">##          V1                        V2      V3      V4  V5   V6
## 1 00-000000             Total nonfarm 137,214 137,147  67  (1)
## 2 05-000000             Total private 114,989 114,884 105  0.1
## 3 06-000000           Goods-producing  18,675  18,558 117  0.6
## 4 07-000000         Service-providing 118,539 118,589 -50  (1)
## 5 08-000000 Private service-providing  96,314  96,326 -12  (1)
## 6 10-000000        Mining and logging     868     884 -16 -1.8
</span>
<span class="n">head</span><span class="p">(</span><span class="n">bls_table3</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>
<span class="c1">##   CES Industry Code CES Industry Title Apr May Jun Jul Aug Sep Oct Nov Dec   CumulativeTotal
## 1         10-000000 Mining and logging   2   2   2   2   1   1   1   1   0                12
## 2         20-000000       Construction  35  37  24  12  12   7  12 -10 -21               108
</span><span class="err">##</span> <span class="m">3</span>         <span class="m">30-000000</span>      <span class="n">Manufacturing</span>   <span class="m">0</span>   <span class="m">6</span>   <span class="m">4</span>  <span class="m">-3</span>   <span class="m">4</span>   <span class="m">1</span>   <span class="m">3</span>   <span class="m">2</span>   <span class="m">0</span>                <span class="m">17</span></code></pre></figure>

<p>A few benefits of <code class="highlighter-rouge">XML</code>’s <code class="highlighter-rouge">readHTMLTable</code> that are routinely handy include:</p>

<ul>
  <li>We can specify names for the column headings</li>
  <li>We can specify the classes for each column</li>
  <li>We can specify rows to skip</li>
</ul>

<p>For instance, if you look at <code class="highlighter-rouge">bls_table2</code> above notice that because of the split column headings on <em>Table 2. Nonfarm employment…</em> <code class="highlighter-rouge">readHTMLTable</code> stripped and replaced the headings with generic names because R does not know which variable names should align with each column. We can correct for this with the following:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">bls_table2</span> <span class="o">&lt;-</span> <span class="n">readHTMLTable</span><span class="p">(</span><span class="n">tableNodes</span><span class="p">[[</span><span class="m">1</span><span class="p">]],</span> 
                            <span class="n">header</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="s2">"CES_Code"</span><span class="p">,</span> <span class="s2">"Ind_Title"</span><span class="p">,</span> <span class="s2">"Benchmark"</span><span class="p">,</span>
                            <span class="s2">"Estimate"</span><span class="p">,</span> <span class="s2">"Amt_Diff"</span><span class="p">,</span> <span class="s2">"Pct_Diff"</span><span class="p">))</span>

<span class="n">head</span><span class="p">(</span><span class="n">bls_table2</span><span class="p">)</span>
<span class="c1">##    CES_Code                 Ind_Title Benchmark Estimate Amt_Diff Pct_Diff
## 1 00-000000             Total nonfarm   137,214  137,147       67      (1)
## 2 05-000000             Total private   114,989  114,884      105      0.1
## 3 06-000000           Goods-producing    18,675   18,558      117      0.6
## 4 07-000000         Service-providing   118,539  118,589      -50      (1)
## 5 08-000000 Private service-providing    96,314   96,326      -12      (1)
</span><span class="err">##</span> <span class="m">6</span> <span class="m">10-000000</span>        <span class="n">Mining</span> <span class="n">and</span> <span class="n">logging</span>       <span class="m">868</span>      <span class="m">884</span>      <span class="m">-16</span>     <span class="m">-1.8</span></code></pre></figure>

<p>Also, for <code class="highlighter-rouge">bls_table3</code> note that the net birth/death values parsed have been converted to factor levels.  We can use the <code class="highlighter-rouge">colClasses</code> argument to correct this.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">str</span><span class="p">(</span><span class="n">bls_table3</span><span class="p">)</span>
<span class="c1">## 'data.frame':	11 obs. of  12 variables:
##  $ CES Industry Code : Factor w/ 11 levels "10-000000","20-000000",..: 1 2 3 4 5 6 7 8 9 10 ...
##  $ CES Industry Title: Factor w/ 11 levels "263","Construction",..: 8 2 7 11 5 4 10 3 6 9 ...
##  $ Apr               : Factor w/ 10 levels "0","12","2","204",..: 3 7 1 5 1 8 9 6 10 2 ...
##  $ May               : Factor w/ 10 levels "129","13","2",..: 3 6 8 5 7 9 4 2 10 8 ...
##  $ Jun               : Factor w/ 10 levels "-14","0","12",..: 5 6 7 3 2 7 8 1 10 9 ...
##  $ Jul               : Factor w/ 10 levels "-1","-2","-3",..: 6 5 3 10 1 7 8 10 9 2 ...
##  $ Aug               : Factor w/ 9 levels "-19","1","12",..: 2 3 9 4 8 9 5 6 7 8 ...
##  $ Sep               : Factor w/ 9 levels "-1","-12","-2",..: 5 8 5 9 1 1 2 6 4 3 ...
##  $ Oct               : Factor w/ 10 levels "-17","1","12",..: 2 3 6 5 9 4 10 7 1 8 ...
##  $ Nov               : Factor w/ 8 levels "-10","-15","-22",..: 4 1 7 5 8 8 6 6 3 4 ...
##  $ Dec               : Factor w/ 8 levels "-10","-21","-3",..: 4 2 4 7 4 6 1 3 7 5 ...
##  $ CumulativeTotal   : Factor w/ 10 levels "107","108","12",..: 3 2 6 4 5 10 7 1 8 9 ...
</span>
<span class="n">bls_table3</span> <span class="o">&lt;-</span> <span class="n">readHTMLTable</span><span class="p">(</span><span class="n">tableNodes</span><span class="p">[[</span><span class="m">2</span><span class="p">]],</span> 
                            <span class="n">colClasses</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="s2">"character"</span><span class="p">,</span><span class="s2">"character"</span><span class="p">,</span> 
                                           <span class="n">rep</span><span class="p">(</span><span class="s2">"integer"</span><span class="p">,</span> <span class="m">10</span><span class="p">)))</span>

<span class="n">str</span><span class="p">(</span><span class="n">bls_table3</span><span class="p">)</span>
<span class="c1">## 'data.frame':	11 obs. of  12 variables:
##  $ CES Industry Code : Factor w/ 11 levels "10-000000","20-000000",..: 1 2 3 4 5 6 7 8 9 10 ...
##  $ CES Industry Title: Factor w/ 11 levels "263","Construction",..: 8 2 7 11 5 4 10 3 6 9 ...
##  $ Apr               : int  2 35 0 21 0 8 81 22 82 12 ...
##  $ May               : int  2 37 6 24 5 8 22 13 81 6 ...
##  $ Jun               : int  2 24 4 12 0 4 5 -14 86 6 ...
##  $ Jul               : int  2 12 -3 7 -1 3 35 7 62 -2 ...
##  $ Aug               : int  1 12 4 14 3 4 19 21 23 3 ...
##  $ Sep               : int  1 7 1 9 -1 -1 -12 12 -33 -2 ...
##  $ Oct               : int  1 12 3 28 6 16 76 35 -17 4 ...
##  $ Nov               : int  1 -10 2 10 3 3 14 14 -22 1 ...
##  $ Dec               : int  0 -21 0 4 0 10 -10 -3 4 1 ...
</span><span class="err">##</span>  <span class="o">$</span> <span class="n">CumulativeTotal</span>   <span class="o">:</span> <span class="n">int</span>  <span class="m">12</span> <span class="m">108</span> <span class="m">17</span> <span class="m">129</span> <span class="m">15</span> <span class="m">55</span> <span class="m">230</span> <span class="m">107</span> <span class="m">266</span> <span class="m">29</span> <span class="k">...</span></code></pre></figure>

<p>Between <code class="highlighter-rouge">rvest</code> and <code class="highlighter-rouge">XML</code>, scraping HTML tables is relatively easy once you get fluent with the syntax and the available options.  This tutorial covers just the basics of both these packages to get you moving forward with scraping tables. In the next tutorial we move on to working with application program interfaces (APIs) to get data from the web.</p>

<p><small><a href="#">Go to top</a></small></p>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">

      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
        <center>
          <li>
            <a href="https://github.com/bradleyboehmke">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>
            </a>
            &nbsp;
            <a href="http://www.twitter.com/bradleyboehmke">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>
            </a>
            &nbsp;
            <a href="https://www.linkedin.com/in/brad-boehmke-ph-d-9b0a257">
              <span class="icon  icon--linkedin">
                <svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"  width="25" height="25" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path fill="#828282" d="M13.632 13.635h-2.37V9.922c0-.886-.018-2.025-1.234-2.025-1.235 0-1.424.964-1.424 1.96v3.778h-2.37V6H8.51V7.04h.03c.318-.6 1.092-1.233 2.247-1.233 2.4 0 2.845 1.58 2.845 3.637v4.188zM3.558 4.955c-.762 0-1.376-.617-1.376-1.377 0-.758.614-1.375 1.376-1.375.76 0 1.376.617 1.376 1.375 0 .76-.617 1.377-1.376 1.377zm1.188 8.68H2.37V6h2.376v7.635zM14.816 0H1.18C.528 0 0 .516 0 1.153v13.694C0 15.484.528 16 1.18 16h13.635c.652 0 1.185-.516 1.185-1.153V1.153C16 .516 15.467 0 14.815 0z" fill-rule="nonzero"/>
                </svg>
              </span>
            </a>
          </li>

        </ul>
        </center>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text"></p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
