<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Bradley Boehmke</title>
    <meta name="description" content="">

    <link rel="stylesheet" href="http://bradleyboehmke.github.io//css/main.css">
    <link rel="canonical" href="http://bradleyboehmke.github.io/http://bradleyboehmke.github.io//tutorials/scraping_data_api">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="http://bradleyboehmke.github.io/">Bradley Boehmke</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="http://bradleyboehmke.github.io//about/">About</a>
          
        
          
        
          
        
          
        
          
          <a class="page-link" href="http://bradleyboehmke.github.io//categoryview/">Archive</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
          <a class="page-link" href="http://bradleyboehmke.github.io//cv/">CV</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
          <a class="page-link" href="http://bradleyboehmke.github.io//tutorials/">Tutorials</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
          <a class="page-link" href="http://bradleyboehmke.github.io//tutorials/scraping_with_apis_DSCOE.Rmd">Scraping Data with APIs</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <article class="post-content">
    <p><a href="index">R Vocab Topics</a> » <a href="data_inputs_outputs">Importing, Scraping, and exporting data</a> » <a href="scraping_data">Scraping data</a> » Working with APIs</p>

<p><br /></p>

<p>In this tutorial I cover how to scrape data via APIs. I first provide some explanation about what APIs are followed by some prerequisites for working with APIs. I then cover a few pre-existing R API packages to demonstrate how they typically function.  I then cover the <code class="highlighter-rouge">httr</code> package to work with APIs in which an R package has not already been built to simplify interaction with.</p>

<p><br /></p>

<p><a name="what_api"></a></p>

<h2 id="whats-an-api">What’s an API?</h2>
<p>An <a href="https://en.wikipedia.org/wiki/Application_programming_interface">application-programming interface (API)</a> in a nutshell is a method of communication between software programs.  APIs allow programs to interact and use each other’s functions by acting as a middle man. Why is this useful? Lets say you want to pull weather data from the <a href="http://www.ncdc.noaa.gov/cdo-web/webservices">NOAA</a>.  You have a few options:</p>

<ul>
  <li>You could query the data and download the spreadsheet or manually cut-n-paste the desired data and then import into R. Doesn’t get you any coolness points.</li>
  <li>You could use some webscraping techniques previously covered <a href="http://bradleyboehmke.github.io/2015/12/scraping-tabular-and-excel-files-stored-online.html">here</a>, <a href="http://bradleyboehmke.github.io/2015/12/scraping-html-text.html">here</a>, and <a href="http://bradleyboehmke.github.io/2015/12/scraping-html-tables.html">here</a> to parse the desired data. Golf clap. The downfall of this strategy is if NOAA changes their website structure down the road your code will need to be adjusted.</li>
  <li>Or, you can use the <a href="https://ropensci.org/tutorials/rnoaa_tutorial.html"><code class="highlighter-rouge">rnoaa</code></a> package which allows you to send specific instructions to the NOAA API via R, the API will then perform the action requested and return the desired information. The benefit of this strategy is if the NOAA changes its website structure it won’t impact the API data retreival structure which means no impact to your code. Standing ovation!</li>
</ul>

<p>Consequently, APIs provide consistency in data retrieval processes which can be essential for recurring analyses. Luckily, the use of APIs by organizations that collect data are <a href="http://www.programmableweb.com/api-research">growing exponentially</a>. This is great for you and I as more and more data continues to be at our finger tips.</p>

<p>So what do you need to get started?</p>

<p><small><a href="#">Go to top</a></small></p>

<p><br /></p>

<p><a name="needs_api"></a></p>

<h2 id="prerequisites">Prerequisites</h2>
<p>Each API is unique; however, there are a few fundamental pieces of information you’ll need to work with an API.  First, the reason you’re using an API is to request specific types of data from a specific data set from a specific organization. You at least need to know a little something about each one of these:</p>

<ol>
  <li>The URL for the organization and data you are pulling. Most pre-built API packages already have this connection established but when using <code>httr</code> you'll need to specify.</li>
  <li>The data set you are trying to pull from. Most organizations have numerous data sets to peruse so you need to make yourself familiar with the names of the available data sets.</li>
  <li>The data content. You'll need to specify the specific data variables you want the API to retrieve so you'll need to be familiar with, or have access to, the data library.</li>
</ol>

<p>In addition to these key components you will also, typically, need to provide a form of identification and/or authorization.  This is done via:</p>

<ol start="4">
  <li>API key (aka token). A key is used to identify the user along with track and control how the API is being used (guard against malicious use). A key is often obtained by supplying basic information (i.e. name, email) to the organization and in return they give you a multi-digit key.</li>
  <li><a href="http://oauth.net/">OAuth</a>. OAuth is an authorization framework that provides credentials as proof for access to certain information. Multiple forms of credentials exist and OAuth can actually be a fairly confusing topic; however, the <code>httr</code> package has simplified this greatly which we demonstrate <a href="#httr_api">later</a> in this post.</li>
</ol>

<p>Rather than dwell on these components, they’ll likely become clearer as we progress through examples. So, let’s move on to the fun stuff.</p>

<p><small><a href="#">Go to top</a></small></p>

<p><br /></p>

<p><a name="existing_api"></a></p>

<h2 id="existing-api-packages">Existing API Packages</h2>
<p>Like everything else you do in R, when looking to work with an API your first question should be “Is there a package for that?” R has an extensive list of packages in which API data feeds have been hooked into R. You can find a slew of them scattered throughout the <a href="https://cran.r-project.org/web/views/WebTechnologies.html">CRAN Task View: Web Technologies and Services</a> web page, on the <a href="https://ropensci.org/packages/">rOpenSci</a> web page, and some more <a href="http://stats.stackexchange.com/questions/12670/data-apis-feeds-available-as-packages-in-r">here</a>.</p>

<p>To give you a taste for how these packages typically work, I’ll quickly cover three packages:</p>

<ul>
  <li><a href="#blsAPI"><code class="highlighter-rouge">blsAPI</code></a> for pulling U.S. Bureau of Labor Statistics data</li>
  <li><a href="#rnoaa"><code class="highlighter-rouge">rnoaa</code></a> for pulling NOAA climate data</li>
  <li><a href="#rtimes"><code class="highlighter-rouge">rtimes</code></a> for pulling data from multiple APIs offered by the New York Times</li>
</ul>

<p><a name="blsAPI"></a></p>

<h3 id="blsapi">blsAPI</h3>
<p>The <a href="https://cran.r-project.org/web/packages/blsAPI/index.html"><code class="highlighter-rouge">blsAPI</code></a> allows users to request data for one or multiple series through the U.S. Bureau of Labor Statistics API. To use the <code class="highlighter-rouge">blsAPI</code> app you only need knowledge on the data; no key or OAuth are required. I lllustrate by pulling <a href="http://www.bls.gov/mls/mlsover.htm">Mass Layoff Statistics</a> data but you will find all the available data sets and their series code information <a href="http://www.bls.gov/help/hlpforma.htm">here</a>.</p>

<p>The key information you will be concerned about is contained in the series identifier.  For the Mass Layoff data the the series ID code  is MLUMS00NN0001003. Each component of this series code has meaning and can be adjusted to get specific Mass Layoff data.  The BLS provides this <a href="http://www.bls.gov/help/hlpforma.htm#ML">breakdown</a> for what each component means along with the available list of codes for this data set.  For instance, the <strong>S00</strong> (MLUM<strong>S00</strong>NN0001003) component represents the <a href="http://download.bls.gov/pub/time.series/ml/ml.srd">division/state</a>. S00 will pull for all states but I could change to D30 to pull data for the Midwest or S39 to pull for Ohio. The <strong>N0001</strong> (MLUMS00N<strong>N0001</strong>003) component represents the <a href="http://download.bls.gov/pub/time.series/ml/ml.irc">industry/demographics</a>. N0001 pulls data for all industries but I could change to N0008 to pull data for the food industry or C00A2 for all persons age 30-44.</p>

<p>I simply call the series identifier in the <code class="highlighter-rouge">blsAPI()</code> function which pulls the JSON data object.  We can then use the <code class="highlighter-rouge">fromJSON()</code> function from the <code class="highlighter-rouge">rjson</code> package to convert to an R data object (a list in this case). You can see that the raw data pull provides a list of 4 items.  The first three provide some metadata info (status, response time, and message if applicable). The data we are concerned about is in the 4th (Results$series$data) list item which contains 31 observations.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">rjson</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">blsAPI</span><span class="p">)</span>

<span class="c1"># supply series identifier to pull data (initial pull is in JSON data)
</span><span class="n">layoffs_json</span> <span class="o">&lt;-</span> <span class="n">blsAPI</span><span class="p">(</span><span class="s1">'MLUMS00NN0001003'</span><span class="p">)</span> 

<span class="c1"># convert from JSON into R object
</span><span class="n">layoffs</span> <span class="o">&lt;-</span> <span class="n">fromJSON</span><span class="p">(</span><span class="n">layoffs_json</span><span class="p">)</span>                   

<span class="n">List</span> <span class="n">of</span> <span class="m">4</span>
 <span class="o">$</span> <span class="n">status</span>      <span class="o">:</span> <span class="n">chr</span> <span class="s2">"REQUEST_SUCCEEDED"</span>
 <span class="o">$</span> <span class="n">responseTime</span><span class="o">:</span> <span class="n">num</span> <span class="m">38</span>
 <span class="o">$</span> <span class="n">message</span>     <span class="o">:</span> <span class="n">list</span><span class="p">()</span>
 <span class="o">$</span> <span class="n">Results</span>     <span class="o">:</span><span class="n">List</span> <span class="n">of</span> <span class="m">1</span>
  <span class="err">..</span><span class="o">$</span> <span class="n">series</span><span class="o">:</span><span class="n">List</span> <span class="n">of</span> <span class="m">1</span>
  <span class="err">..</span> <span class="err">..</span><span class="o">$</span> <span class="o">:</span><span class="n">List</span> <span class="n">of</span> <span class="m">2</span>
  <span class="err">..</span> <span class="err">..</span> <span class="err">..</span><span class="o">$</span> <span class="n">seriesID</span><span class="o">:</span> <span class="n">chr</span> <span class="s2">"MLUMS00NN0001003"</span>
  <span class="err">..</span> <span class="err">..</span> <span class="err">..</span><span class="o">$</span> <span class="n">data</span>    <span class="o">:</span><span class="n">List</span> <span class="n">of</span> <span class="m">31</span>
  <span class="err">..</span> <span class="err">..</span> <span class="err">..</span> <span class="err">..</span><span class="o">$</span> <span class="o">:</span><span class="n">List</span> <span class="n">of</span> <span class="m">5</span>
  <span class="err">..</span> <span class="err">..</span> <span class="err">..</span> <span class="err">..</span> <span class="err">..</span><span class="o">$</span> <span class="n">year</span>      <span class="o">:</span> <span class="n">chr</span> <span class="s2">"2013"</span>
  <span class="err">..</span> <span class="err">..</span> <span class="err">..</span> <span class="err">..</span> <span class="err">..</span><span class="o">$</span> <span class="n">period</span>    <span class="o">:</span> <span class="n">chr</span> <span class="s2">"M05"</span>
  <span class="err">..</span> <span class="err">..</span> <span class="err">..</span> <span class="err">..</span> <span class="err">..</span><span class="o">$</span> <span class="n">periodName</span><span class="o">:</span> <span class="n">chr</span> <span class="s2">"May"</span>
  <span class="err">..</span> <span class="err">..</span> <span class="err">..</span> <span class="err">..</span> <span class="err">..</span><span class="o">$</span> <span class="n">value</span>     <span class="o">:</span> <span class="n">chr</span> <span class="s2">"1383"</span></code></pre></figure>

<p>One of the inconveniences of an API is we do not get to specify how the data we receive is formatted. This is a minor price to pay considering all the other benefits APIs provide. Once we understand the received data format we can typically re-format using a little subsetting and looping.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># create empty data frame to fill  
</span><span class="n">layoff_df</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">NULL</span><span class="p">)</span>

<span class="c1"># extract data of interest from each nested year-month list  
</span><span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="n">seq_along</span><span class="p">(</span><span class="n">layoffs</span><span class="o">$</span><span class="n">Results</span><span class="o">$</span><span class="n">series</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="o">$</span><span class="n">data</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">df</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">layoffs</span><span class="o">$</span><span class="n">Results</span><span class="o">$</span><span class="n">series</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="o">$</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][[</span><span class="m">1</span><span class="p">]][</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">])</span>
        <span class="n">layoff_df</span> <span class="o">&lt;-</span> <span class="n">rbind</span><span class="p">(</span><span class="n">layoff_df</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">head</span><span class="p">(</span><span class="n">layoff_df</span><span class="p">)</span>
<span class="c1">##   year period periodName value
## 1 2013    M05        May  1383
## 2 2013    M04      April  1174
## 3 2013    M03      March  1132
## 4 2013    M02   February   960
## 5 2013    M01    January  1528
</span><span class="err">##</span> <span class="m">6</span> <span class="m">2012</span>    <span class="n">M13</span>     <span class="n">Annual</span> <span class="m">17080</span></code></pre></figure>

<p><code class="highlighter-rouge">blsAPI</code> also allows you to pull multiple data series and has optional arguments (i.e. start year, end year, etc.). You can see other options at <code class="highlighter-rouge">help(package = blsAPI)</code>.</p>

<p><a name="rnoaa"></a></p>

<h3 id="rnoaa">rnoaa</h3>
<p>The <a href="https://ropensci.org/tutorials/rnoaa_tutorial.html"><code class="highlighter-rouge">rnoaa</code></a> package allows users to request climate data from multiple data sets through the <a href="http://www.ncdc.noaa.gov/cdo-web/webservices/v2">National Climatic Data Center API</a>. Unlike <code class="highlighter-rouge">blsAPI</code>, the <code class="highlighter-rouge">rnoaa</code> app requires you to have an API key.  To request a key go <a href="http://www.ncdc.noaa.gov/cdo-web/token">here</a> and provide your email; a key will immediately be emailed to you.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">key</span> <span class="o">&lt;-</span> <span class="s2">"vXTdwNoAVx..."</span> <span class="err">#</span> <span class="n">truncated</span> </code></pre></figure>

<p>With the key in hand, we can begin pulling data.  The NOAA provides a comprehensive <a href="http://www.ncdc.noaa.gov/homr/reports">metadata library</a> to familiarize yourself with the data available. Let’s start by pulling all the available NOAA climate stations near my residence. I live in Montgomery county Ohio so we can find all the stations in this county by inserting the <a href="http://www.census.gov/geo/reference/codes/cou.html">FIPS code</a>. Furthermore, I’m interested in stations that provide data for the <a href="https://www.ncdc.noaa.gov/oa/climate/ghcn-daily/"><code class="highlighter-rouge">GHCND</code> data set</a> which contains records on numerous daily variables such as “maximum and minimum temperature, total daily precipitation, snowfall, and snow depth; however, about two thirds of the stations report precipitation only.” See <code class="highlighter-rouge">?ncdc_stations</code> for other data sets available via <code class="highlighter-rouge">rnoaa</code>.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">rnoaa</span><span class="p">)</span>

<span class="n">stations</span> <span class="o">&lt;-</span> <span class="n">ncdc_stations</span><span class="p">(</span><span class="n">datasetid</span><span class="o">=</span><span class="s1">'GHCND'</span><span class="p">,</span> 
              <span class="n">locationid</span><span class="o">=</span><span class="s1">'FIPS:39113'</span><span class="p">,</span>
              <span class="n">token</span> <span class="o">=</span> <span class="n">key</span><span class="p">)</span>

<span class="n">stations</span><span class="o">$</span><span class="n">data</span>
<span class="c1">## Source: local data frame [23 x 9]
## 
##    elevation    mindate    maxdate latitude
##        (dbl)      (chr)      (chr)    (dbl)
## 1      294.1 2009-02-09 2014-06-25  39.6314
## 2      251.8 2009-03-01 2016-01-16  39.6807
## 3      295.7 2009-03-25 2012-09-08  39.6252
## 4      298.1 2009-08-24 2012-07-20  39.8070
## 5      304.5 2010-04-02 2016-01-12  39.6949
## 6      283.5 2012-07-01 2016-01-16  39.7373
## 7      301.4 2012-07-29 2016-01-16  39.8795
## 8      317.3 2012-09-08 2016-01-12  39.8329
## 9      298.1 2012-09-07 2016-01-15  39.6247
## 10     250.5 2012-09-11 2016-01-08  39.7180
## ..       ...        ...        ...      ...
## Variables not shown: name (chr), datacoverage (dbl), id (chr),
</span><span class="err">##</span>   <span class="n">elevationUnit</span> <span class="p">(</span><span class="n">chr</span><span class="p">),</span> <span class="n">longitude</span> <span class="p">(</span><span class="n">dbl</span><span class="p">)</span></code></pre></figure>

<p>So we see that several stations are available from which to pull data. To actually pull data from one of these stations we need the station ID.  The station I want to pull data from is the Dayton International Airport station.  We can see that this station provides data from 1948-present and I can get the station ID as illustrated.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>

<span class="n">stations</span><span class="o">$</span><span class="n">data</span> <span class="o">%&gt;%</span> 
        <span class="n">filter</span><span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"DAYTON INTERNATIONAL AIRPORT, OH US"</span><span class="p">)</span> <span class="o">%&gt;%</span> 
        <span class="n">select</span><span class="p">(</span><span class="n">mindate</span><span class="p">,</span> <span class="n">maxdate</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span>
<span class="c1">## Source: local data frame [1 x 3]
## 
##      mindate    maxdate                id
##        (chr)      (chr)             (chr)
</span><span class="err">##</span> <span class="m">1</span> <span class="m">1948-01-01</span> <span class="m">2016-01-15</span> <span class="n">GHCND</span><span class="o">:</span><span class="n">USW00093815</span></code></pre></figure>

<p>To pull all available GHCND data from this station we’ll use <code class="highlighter-rouge">ncdc()</code>.  We simply supply the data to pull, the start and end dates (<code class="highlighter-rouge">ncdc</code> restricts you to a one year limit), station ID, and your key. We can see that this station provides a full range of data types.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">climate</span> <span class="o">&lt;-</span> <span class="n">ncdc</span><span class="p">(</span><span class="n">datasetid</span><span class="o">=</span><span class="s1">'GHCND'</span><span class="p">,</span> 
            <span class="n">startdate</span> <span class="o">=</span> <span class="s1">'2015-01-01'</span><span class="p">,</span> 
            <span class="n">enddate</span> <span class="o">=</span> <span class="s1">'2016-01-01'</span><span class="p">,</span> 
            <span class="n">stationid</span><span class="o">=</span><span class="s1">'GHCND:USW00093815'</span><span class="p">,</span>
            <span class="n">token</span> <span class="o">=</span> <span class="n">key</span><span class="p">)</span>

<span class="n">climate</span><span class="o">$</span><span class="n">data</span>
<span class="c1">## Source: local data frame [25 x 8]
## 
##                   date datatype           station value  fl_m  fl_q
##                  (chr)    (chr)             (chr) (int) (chr) (chr)
## 1  2015-01-01T00:00:00     AWND GHCND:USW00093815    72            
## 2  2015-01-01T00:00:00     PRCP GHCND:USW00093815     0            
## 3  2015-01-01T00:00:00     SNOW GHCND:USW00093815     0            
## 4  2015-01-01T00:00:00     SNWD GHCND:USW00093815     0            
## 5  2015-01-01T00:00:00     TAVG GHCND:USW00093815   -38     H      
## 6  2015-01-01T00:00:00     TMAX GHCND:USW00093815    28            
## 7  2015-01-01T00:00:00     TMIN GHCND:USW00093815   -71            
## 8  2015-01-01T00:00:00     WDF2 GHCND:USW00093815   240            
## 9  2015-01-01T00:00:00     WDF5 GHCND:USW00093815   240            
## 10 2015-01-01T00:00:00     WSF2 GHCND:USW00093815   130            
## ..                 ...      ...               ...   ...   ...   ...
</span><span class="err">##</span> <span class="n">Variables</span> <span class="n">not</span> <span class="n">shown</span><span class="o">:</span> <span class="n">fl_so</span> <span class="p">(</span><span class="n">chr</span><span class="p">),</span> <span class="n">fl_t</span> <span class="p">(</span><span class="n">chr</span><span class="p">)</span></code></pre></figure>

<p>Since we recently had some snow here let’s pull data on snow fall for 2015. We adjust the limit argument (by default <code class="highlighter-rouge">ncdc</code> limits results to 25) and identify the data type we want.  By sorting we see what days experienced the greatest snowfall (don’t worry, the results are reported in mm!).</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">snow</span> <span class="o">&lt;-</span> <span class="n">ncdc</span><span class="p">(</span><span class="n">datasetid</span><span class="o">=</span><span class="s1">'GHCND'</span><span class="p">,</span> 
            <span class="n">startdate</span> <span class="o">=</span> <span class="s1">'2015-01-01'</span><span class="p">,</span> 
            <span class="n">enddate</span> <span class="o">=</span> <span class="s1">'2015-12-31'</span><span class="p">,</span> 
            <span class="n">limit</span> <span class="o">=</span> <span class="m">365</span><span class="p">,</span>
            <span class="n">stationid</span><span class="o">=</span><span class="s1">'GHCND:USW00093815'</span><span class="p">,</span>
            <span class="n">datatypeid</span> <span class="o">=</span> <span class="s1">'SNOW'</span><span class="p">,</span>
            <span class="n">token</span> <span class="o">=</span> <span class="n">key</span><span class="p">)</span>

<span class="n">snow</span><span class="o">$</span><span class="n">data</span> <span class="o">%&gt;%</span> 
        <span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
<span class="c1">## Source: local data frame [365 x 8]
## 
##                   date datatype           station value  fl_m  fl_q
##                  (chr)    (chr)             (chr) (int) (chr) (chr)
## 1  2015-03-01T00:00:00     SNOW GHCND:USW00093815   114            
## 2  2015-02-21T00:00:00     SNOW GHCND:USW00093815   109            
## 3  2015-01-25T00:00:00     SNOW GHCND:USW00093815    71            
## 4  2015-01-06T00:00:00     SNOW GHCND:USW00093815    66            
## 5  2015-02-16T00:00:00     SNOW GHCND:USW00093815    30            
## 6  2015-02-18T00:00:00     SNOW GHCND:USW00093815    25            
## 7  2015-02-14T00:00:00     SNOW GHCND:USW00093815    23            
## 8  2015-01-26T00:00:00     SNOW GHCND:USW00093815    20            
## 9  2015-02-04T00:00:00     SNOW GHCND:USW00093815    20            
## 10 2015-02-12T00:00:00     SNOW GHCND:USW00093815    20            
## ..                 ...      ...               ...   ...   ...   ...
</span><span class="err">##</span> <span class="n">Variables</span> <span class="n">not</span> <span class="n">shown</span><span class="o">:</span> <span class="n">fl_so</span> <span class="p">(</span><span class="n">chr</span><span class="p">),</span> <span class="n">fl_t</span> <span class="p">(</span><span class="n">chr</span><span class="p">)</span></code></pre></figure>

<p>This is just an intro to <code class="highlighter-rouge">rnoaa</code> as the package offers a slew of data sets to pull from and functions to apply.  It even offers built in plotting functions. Use <code class="highlighter-rouge">help(package = "rnoaa")</code> to see all that <code class="highlighter-rouge">rnoaa</code> has to offer.</p>

<p><a name="rtimes"></a></p>

<h3 id="rtimes">rtimes</h3>
<p>The <a href="https://cran.r-project.org/web/packages/rtimes/index.html"><code class="highlighter-rouge">rtimes</code></a> package provides an interface to Congress, Campaign Finance, Article Search, and Geographic APIs offered by the New York Times. The data libraries and documentation for the several APIs available can be found <a href="http://developer.nytimes.com/docs/">here</a>. To use the Times’ API you’ll need to get an API key <a href="http://developer.nytimes.com/apps/register">here</a>.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">article_key</span> <span class="o">&lt;-</span> <span class="s2">"4f23572d8..."</span>     <span class="c1"># truncated
</span><span class="n">cfinance_key</span> <span class="o">&lt;-</span> <span class="s2">"ee0b7cef..."</span>     <span class="c1"># truncated
</span><span class="n">congress_key</span> <span class="o">&lt;-</span> <span class="s2">"57b3e8a3..."</span>     <span class="err">#</span> <span class="n">truncated</span></code></pre></figure>

<p>Lets start by searching NY Times articles. With the presendential elections upon us, we can illustrate by searching the least controversial candidate…Donald Trump. We can see that there are 4,566 article hits for the term “Trump”. We can get more information on a particular article by subsetting.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">rtimes</span><span class="p">)</span>

<span class="c1"># article search for the term 'Trump'
</span><span class="n">articles</span> <span class="o">&lt;-</span> <span class="n">as_search</span><span class="p">(</span><span class="n">q</span> <span class="o">=</span> <span class="s2">"Trump"</span><span class="p">,</span> 
                 <span class="n">begin_date</span> <span class="o">=</span> <span class="s2">"20150101"</span><span class="p">,</span> 
                 <span class="n">end_date</span> <span class="o">=</span> <span class="s1">'20160101'</span><span class="p">,</span>
                 <span class="n">key</span> <span class="o">=</span> <span class="n">article_key</span><span class="p">)</span>

<span class="c1"># summary
</span><span class="n">articles</span><span class="o">$</span><span class="n">meta</span>
<span class="c1">##   hits time offset
## 1 4565   28      0
</span>
<span class="c1"># pull info on 3rd article
</span><span class="n">articles</span><span class="o">$</span><span class="n">data</span><span class="p">[</span><span class="m">3</span><span class="p">]</span>
<span class="c1">## [[1]]
## &lt;NYTimes article&gt;Donald Trump’s Strongest Supporters: A Certain Kind of Democrat
##   Type: News
##   Published: 2015-12-31T00:00:00Z
##   Word count: 1469
##   URL: http://www.nytimes.com/2015/12/31/upshot/donald-trumps-strongest-supporters-a-certain-kind-of-democrat.html
</span><span class="err">##</span>   <span class="n">Snippet</span><span class="o">:</span> <span class="n">In</span> <span class="n">a</span> <span class="n">survey</span><span class="p">,</span> <span class="n">he</span> <span class="n">also</span> <span class="n">excels</span> <span class="n">among</span> <span class="n">low</span><span class="o">-</span><span class="n">turnout</span> <span class="n">voters</span> <span class="n">and</span> <span class="n">among</span> <span class="n">the</span> <span class="n">less</span> <span class="n">affluent</span> <span class="n">and</span> <span class="n">the</span> <span class="n">less</span> <span class="n">educated</span><span class="p">,</span> <span class="n">so</span> <span class="n">the</span> <span class="n">question</span> <span class="n">is</span><span class="o">:</span> <span class="n">Will</span> <span class="n">they</span> <span class="n">show</span> <span class="n">up</span> <span class="n">to</span> <span class="n">vote</span><span class="o">?</span></code></pre></figure>

<p>We can use the campaign finance API and functions to gain some insight into Trumps compaign income and expenditures. The only special data you need is the <a href="http://www.fec.gov/finance/disclosure/candcmte_info.shtml?tabIndex=2">FEC ID</a> for the candidate of interest.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">trump</span> <span class="o">&lt;-</span> <span class="n">cf_candidate_details</span><span class="p">(</span><span class="n">campaign_cycle</span> <span class="o">=</span> <span class="m">2016</span><span class="p">,</span> 
                     <span class="n">fec_id</span> <span class="o">=</span> <span class="s1">'P80001571'</span><span class="p">,</span>
                     <span class="n">key</span> <span class="o">=</span> <span class="n">cfinance_key</span><span class="p">)</span>

<span class="c1"># pull summary data
</span><span class="n">trump</span><span class="o">$</span><span class="n">meta</span>
<span class="c1">##          id            name party
## 1 P80001571 TRUMP, DONALD J   REP
##                                             fec_uri
## 1 http://docquery.fec.gov/cgi-bin/fecimg/?P80001571
##                    committee  mailing_address mailing_city
## 1 /committees/C00580100.json 725 FIFTH AVENUE     NEW YORK
##   mailing_state mailing_zip status total_receipts
## 1            NY       10022      O     1902410.45
##   total_from_individuals total_from_pacs total_contributions
## 1               92249.33               0            96298.97
##   candidate_loans total_disbursements begin_cash  end_cash
## 1      1804747.23          1414674.29          0 487736.16
##   total_refunds debts_owed date_coverage_from date_coverage_to
## 1             0 1804747.23         2015-04-02       2015-06-30
##   independent_expenditures coordinated_expenditures
</span><span class="err">##</span> <span class="m">1</span>                <span class="m">1644396.8</span>                        <span class="m">0</span></code></pre></figure>

<p><code class="highlighter-rouge">rtimes</code> also allows us to gain some insight into what our locally elected officials are up to with the Congress API. First, I can get some informaton on my Senator and then use that information to see if he’s supporting my interest. For instance, I can pull the most recent bills that he is co-sponsoring.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># pull info on OH senator
</span><span class="n">senator</span> <span class="o">&lt;-</span> <span class="n">cg_memberbystatedistrict</span><span class="p">(</span><span class="n">chamber</span> <span class="o">=</span> <span class="s2">"senate"</span><span class="p">,</span> 
                                    <span class="n">state</span> <span class="o">=</span> <span class="s2">"OH"</span><span class="p">,</span> 
                                    <span class="n">key</span> <span class="o">=</span> <span class="n">congress_key</span><span class="p">)</span>
<span class="n">senator</span><span class="o">$</span><span class="n">meta</span>
<span class="c1">##        id           name               role gender party
## 1 B000944 Sherrod  Brown Senator, 1st Class      M     D
##   times_topics_url      twitter_id       youtube_id seniority
## 1                  SenSherrodBrown SherrodBrownOhio         9
##   next_election
## 1          2018
##                                                                               api_url
## 1 http://api.nytimes.com/svc/politics/v3/us/legislative/congress/members/B000944.json
</span>
<span class="c1"># use member ID to pull recent bill sponsorship
</span><span class="n">bills</span> <span class="o">&lt;-</span> <span class="n">cg_billscosponsor</span><span class="p">(</span><span class="n">memberid</span> <span class="o">=</span> <span class="s2">"B000944"</span><span class="p">,</span> 
                           <span class="n">type</span> <span class="o">=</span> <span class="s2">"cosponsored"</span><span class="p">,</span> 
                           <span class="n">key</span> <span class="o">=</span> <span class="n">congress_key</span><span class="p">)</span>
<span class="n">head</span><span class="p">(</span><span class="n">bills</span><span class="o">$</span><span class="n">data</span><span class="p">)</span>
<span class="c1">## Source: local data frame [6 x 11]
## 
##   congress    number
##      (chr)     (chr)
## 1      114    S.2098
## 2      114    S.2096
## 3      114    S.2100
## 4      114    S.2090
## 5      114 S.RES.267
## 6      114 S.RES.269
## Variables not shown: bill_uri (chr), title (chr), cosponsored_date
##   (chr), sponsor_id (chr), introduced_date (chr), cosponsors (chr),
##   committees (chr), latest_major_action_date (chr),
</span><span class="err">##</span>   <span class="n">latest_major_action</span> <span class="p">(</span><span class="n">chr</span><span class="p">)</span></code></pre></figure>

<p>It looks like the most recent bill Sherrod is co-sponsoring is S.2098 - Student Right to Know Before You Go Act.  Maybe I’ll do a NY Times article search with <code class="highlighter-rouge">as_search()</code> to find out more about this bill…an exercise for another time.</p>

<p>So this gives you some flavor of how these API packages work.  You typically need to know the data sets and variables requested along with an API key. But once you get these basics its pretty straight forward on requesting the data.  Your next question may be, what if the API that I want to get data from does not yet have an R package developed for it?</p>

<p><small><a href="#">Go to top</a></small></p>

<p><br /></p>

<p><a name="httr_api"></a></p>

<h2 id="httr-for-all-things-else">httr for All Things Else</h2>
<p>Although numerous R API packages are available, and cover a wide range of data, you may eventually run into a situation where you want to leverage an organization’s API but an R package does not exist. Enter <a href="https://cran.r-project.org/web/packages/httr/index.html"><code class="highlighter-rouge">httr</code></a>.  <code class="highlighter-rouge">httr</code> was developed by Hadley Wickham to easily work with web APIs. It offers multiple functions (i.e. <code class="highlighter-rouge">HEAD()</code>, <code class="highlighter-rouge">POST()</code>, <code class="highlighter-rouge">PATCH()</code>, <code class="highlighter-rouge">PUT()</code> and <code class="highlighter-rouge">DELETE()</code>); however, the function we are most concerned with today is <code class="highlighter-rouge">Get()</code>. We use the <code class="highlighter-rouge">Get()</code> function to access an API, provide it some request parameters, and receive an output.</p>

<p>To give you a taste for how the <code class="highlighter-rouge">httr</code> package works, I’ll quickly cover how to use it for a basic key-only API and an OAuth-required API:</p>

<ul>
  <li><a href="#key_only"><code class="highlighter-rouge">Key-only API</code></a> is illustrated by pulling U.S. Department of Education data available on <a href="https://api.data.gov/docs/">data.gov</a></li>
  <li><a href="#oauth"><code class="highlighter-rouge">OAuth-required API</code></a> is illustrated by pulling tweets from my personal Twitter feed</li>
</ul>

<p><a name="key_only"></a></p>

<h3 id="key-only-api">Key-only API</h3>
<p>To demonstrate how to use the <code class="highlighter-rouge">httr</code> package for accessing a key-only API, I’ll illustrate with the <a href="https://api.data.gov/docs/ed/">College Scorecard API</a> provided by the Department of Education. First, you’ll need to <a href="https://api.data.gov/signup/">request your API key</a>.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">edu_key</span> <span class="o">&lt;-</span> <span class="s2">"fd783wmS3Z..."</span>     <span class="err">#</span> <span class="n">truncated</span></code></pre></figure>

<p>We can now proceed to use <code class="highlighter-rouge">httr</code> to request data from the API with the <code class="highlighter-rouge">GET()</code> function.  I went to North Dakota State University (NDSU) for my undergrad so I’m interested in pulling some data for this school. I can use the provided <a href="https://collegescorecard.ed.gov/data/documentation/">data library</a> and <a href="https://github.com/18F/open-data-maker/blob/api-docs/API.md">query explanation</a> to determine the parameters required.  In this example, the <code class="highlighter-rouge">URL</code> includes the primary path (“https://api.data.gov/ed/collegescorecard/”), the API version (“v1”), and the endpoint (“schools”). The question mark (“?”) at the end of the URL is included to begin the list of query parameters, which only includes my API key and the school of interest.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">httr</span><span class="p">)</span>

<span class="n">URL</span> <span class="o">&lt;-</span> <span class="s2">"https://api.data.gov/ed/collegescorecard/v1/schools?"</span>

<span class="c1"># import all available data for NDSU
</span><span class="n">ndsu_req</span> <span class="o">&lt;-</span> <span class="n">GET</span><span class="p">(</span><span class="n">URL</span><span class="p">,</span> <span class="n">query</span> <span class="o">=</span> <span class="n">list</span><span class="p">(</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">edu_key</span><span class="p">,</span>
                                  <span class="n">school.name</span> <span class="o">=</span> <span class="s2">"North Dakota State University"</span><span class="p">))</span></code></pre></figure>

<p>This request provides me with every piece of information collected by the U.S. Department of Education for NDSU. To retrieve the contents of this request I use the <code class="highlighter-rouge">content()</code> function which will output the data as an R object (a list in this case).  The data is segmented into two main components: <em>metadata</em> and <em>results</em>. I’m primarily interested in the results.</p>

<p>The results branch of this list provides information on lat-long location, school identifier codes, some basic info on the school (city, number of branches, school website, accreditor, etc.), and then student data for the years 1997-2013.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">ndsu_data</span> <span class="o">&lt;-</span> <span class="n">content</span><span class="p">(</span><span class="n">ndsu_req</span><span class="p">)</span>

<span class="n">names</span><span class="p">(</span><span class="n">ndsu_data</span><span class="p">)</span>
<span class="c1">## [1] "metadata" "results"
</span>
<span class="n">names</span><span class="p">(</span><span class="n">ndsu_data</span><span class="o">$</span><span class="n">results</span><span class="p">[[</span><span class="m">1</span><span class="p">]])</span>
<span class="c1">##  [1] "2008"     "2009"     "2006"     "ope6_id"  "2007"     "2004"    
##  [7] "2013"     "2005"     "location" "2002"     "2003"     "id"      
## [13] "1996"     "1997"     "school"   "1998"     "2012"     "2011"    
</span><span class="err">##</span> <span class="p">[</span><span class="m">19</span><span class="p">]</span> <span class="s2">"2010"</span>     <span class="s2">"ope8_id"</span>  <span class="s2">"1999"</span>     <span class="s2">"2001"</span>     <span class="s2">"2000"</span></code></pre></figure>

<p>To see what kind of student data categories are offered we can assess a single year. You can see that available data includes earnings, academics, student info/demographics, admissions, costs, etc. With such a large data set, which includes many embedded lists, sometimes the easiest way to learn the data structure is to peruse names at different levels.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># student data categories available by year
</span><span class="n">names</span><span class="p">(</span><span class="n">ndsu_data</span><span class="o">$</span><span class="n">results</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="o">$</span><span class="sb">`2013`</span><span class="p">)</span>
<span class="c1">## [1] "earnings"   "academics"  "student"    "admissions" "repayment" 
## [6] "aid"        "cost"       "completion"
</span>
<span class="c1"># cost categories available by year
</span><span class="n">names</span><span class="p">(</span><span class="n">ndsu_data</span><span class="o">$</span><span class="n">results</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="o">$</span><span class="sb">`2013`</span><span class="o">$</span><span class="n">cost</span><span class="p">)</span>
<span class="c1">## [1] "title_iv"      "avg_net_price" "attendance"    "tuition"      
## [5] "net_price"
</span>
<span class="c1"># Avg net price cost categories available by year
</span><span class="n">names</span><span class="p">(</span><span class="n">ndsu_data</span><span class="o">$</span><span class="n">results</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="o">$</span><span class="sb">`2013`</span><span class="o">$</span><span class="n">cost</span><span class="o">$</span><span class="n">avg_net_price</span><span class="p">)</span>
<span class="c1">## [1] "other_academic_year" "overall"             "program_year"       
</span><span class="err">##</span> <span class="p">[</span><span class="m">4</span><span class="p">]</span> <span class="s2">"public"</span>              <span class="s2">"private"</span></code></pre></figure>

<p>So if I’m interested in comparing the rise in cost versus the rise in student debt I can simply pull this data once I’ve identified its location and naming structure.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">magrittr</span><span class="p">)</span>

<span class="c1"># subset list for annual student data only
</span><span class="n">ndsu_yr</span> <span class="o">&lt;-</span> <span class="n">ndsu_data</span><span class="o">$</span><span class="n">results</span><span class="p">[[</span><span class="m">1</span><span class="p">]][</span><span class="n">c</span><span class="p">(</span><span class="n">as.character</span><span class="p">(</span><span class="m">1996</span><span class="o">:</span><span class="m">2013</span><span class="p">))]</span>

<span class="c1"># extract median debt data for each year
</span><span class="n">ndsu_yr</span> <span class="o">%&gt;%</span>
        <span class="n">sapply</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">x</span><span class="o">$</span><span class="n">aid</span><span class="o">$</span><span class="n">median_debt</span><span class="o">$</span><span class="n">completers</span><span class="o">$</span><span class="n">overall</span><span class="p">)</span> <span class="o">%&gt;%</span> 
        <span class="n">unlist</span><span class="p">()</span>
<span class="c1">##    1997    1998    1999    2000    2001    2002    2003    2004 
## 13388.0 13856.0 14500.0 15125.0 15507.0 15639.0 16251.0 16642.5 
##    2005    2006    2007    2008    2009    2010    2011    2012 
## 17125.0 17125.0 17125.0 17250.0 19125.0 21500.0 23000.0 24954.5 
##    2013 
## 25050.0
</span>
<span class="c1"># extract net price for each year
</span><span class="n">ndsu_yr</span> <span class="o">%&gt;%</span> 
        <span class="n">sapply</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="n">x</span><span class="o">$</span><span class="n">cost</span><span class="o">$</span><span class="n">avg_net_price</span><span class="o">$</span><span class="n">overall</span><span class="p">)</span> <span class="o">%&gt;%</span> 
        <span class="n">unlist</span><span class="p">()</span>
<span class="c1">##  2009  2010  2011  2012  2013 
</span><span class="err">##</span> <span class="m">13474</span> <span class="m">12989</span> <span class="m">13808</span> <span class="m">15113</span> <span class="m">14404</span></code></pre></figure>

<p>Quite simple isn’t it…at least once you’ve learned how the query requests are formatted for a particular API.</p>

<p><a name="oauth"></a></p>

<h3 id="oauth-required-api">OAuth-required API</h3>
<p>At the outset I mentioned how OAuth is an authorization framework that provides credentials as proof for access. Many APIs are open to the public and only require an API key; however, some APIs require authorization to account data (think personal Facebook &amp; Twitter accounts). To access these accounts we must provide proper credentials and OAuth authentication allows us to do this. This post is not meant to explain the details of OAuth (for that see <a href="http://hueniverse.com/2007/09/05/explaining-oauth/">this</a>, <a href="https://en.wikipedia.org/wiki/OAuth">this</a>, and <a href="http://hueniverse.com/oauth/">this</a>) but, rather, how to use <code class="highlighter-rouge">httr</code> in times when OAuth is required.</p>

<p>I’ll demonstrate by accessing the Twitter API using my Twitter account. The first thing we need to do is identify the OAuth endpoints used to request access and authorization. To do this we can use <code class="highlighter-rouge">oauth_endpoint()</code> which typically requires a <em>request</em> URL, <em>authorization</em> URL, and <em>access</em> URL. <code class="highlighter-rouge">httr</code> also included some baked-in endpoints to include LinkedIn, Twitter, Vimeo, Google, Facebook, and GitHub. We can see the Twitter endpoints using the following:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">twitter_endpts</span> <span class="o">&lt;-</span> <span class="n">oauth_endpoints</span><span class="p">(</span><span class="s2">"twitter"</span><span class="p">)</span>
<span class="n">twitter_endpts</span>
<span class="c1">## &lt;oauth_endpoint&gt;
##  request:   https://api.twitter.com/oauth/request_token
##  authorize: https://api.twitter.com/oauth/authenticate
</span><span class="err">##</span>  <span class="n">access</span><span class="o">:</span>    <span class="n">https</span><span class="o">://</span><span class="n">api.twitter.com</span><span class="o">/</span><span class="n">oauth</span><span class="o">/</span><span class="n">access_token</span></code></pre></figure>

<p>Next, I register my application at <a href="https://apps.twitter.com/">https://apps.twitter.com/</a>.  One thing to note is during the registration process, it will ask you for the <em>callback url</em>; be sure to use “http://127.0.0.1:1410”. Once registered, Twitter will provide you with keys and access tokens. The two we are concerned about are the API key and API Secret.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">twitter_key</span> <span class="o">&lt;-</span> <span class="s2">"BZgukbCol..."</span>   <span class="c1"># truncated
</span><span class="n">twitter_secret</span> <span class="o">&lt;-</span> <span class="s2">"YpB8Xy..."</span>   <span class="err">#</span> <span class="n">truncated</span></code></pre></figure>

<p>We can then bundle the consumer key and secret into one object with <code class="highlighter-rouge">oauth_app()</code>. The first argument, <code class="highlighter-rouge">appname</code> is simply used as a local identifier; it does not need to match the name you gave the Twitter app you developed at https://apps.twitter.com/.</p>

<p>We are now ready to ask for access credentials. Since Twitter uses OAuth 1.0 we use <code class="highlighter-rouge">oauth1.0_token()</code> function and incorporate the endpoints identified and the <code class="highlighter-rouge">oauth_app</code> object we previously named <code class="highlighter-rouge">twitter_app</code>.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">twitter_token</span> <span class="o">&lt;-</span> <span class="n">oauth1.0_token</span><span class="p">(</span><span class="n">endpoint</span> <span class="o">=</span> <span class="n">twitter_endpts</span><span class="p">,</span> <span class="n">twitter_app</span><span class="p">)</span>

<span class="n">Waiting</span> <span class="k">for</span> <span class="n">authentication</span> <span class="k">in</span> <span class="n">browser...</span>
<span class="n">Press</span> <span class="n">Esc</span><span class="o">/</span><span class="n">Ctrl</span> <span class="o">+</span> <span class="n">C</span> <span class="n">to</span> <span class="n">abort</span>
<span class="n">Authentication</span> <span class="n">complete.</span></code></pre></figure>

<p>Once authentication is complete we can now use the API. I can pull all the tweets that show up on my personal timeline using the <code class="highlighter-rouge">GET()</code> function and the access cridentials I stored in <code class="highlighter-rouge">twitter_token</code>.  I then use <code class="highlighter-rouge">content()</code> to convert to a list and I can start to analyze the data.</p>

<p>In this case each tweet is saved as an individual list item and a full range of data are provided for each tweet (i.e. id, text, user, geo location, favorite count, etc). For instance, we can see that the first tweet was by <a href="http://fivethirtyeight.com/">FiveThirtyEight</a> concerning American politics and, at the time of this analysis, has been favorited by 3 people.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># request Twitter data
</span><span class="n">req</span> <span class="o">&lt;-</span> <span class="n">GET</span><span class="p">(</span><span class="s2">"https://api.twitter.com/1.1/statuses/home_timeline.json"</span><span class="p">,</span>
           <span class="n">config</span><span class="p">(</span><span class="n">token</span> <span class="o">=</span> <span class="n">twitter_token</span><span class="p">))</span>

<span class="c1"># convert to R object
</span><span class="n">tweets</span> <span class="o">&lt;-</span> <span class="n">content</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>

<span class="c1"># available data for first tweet on my timeline
</span><span class="n">names</span><span class="p">(</span><span class="n">tweets</span><span class="p">[[</span><span class="m">1</span><span class="p">]])</span>
 <span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s2">"created_at"</span>                    <span class="s2">"id"</span>                           
 <span class="p">[</span><span class="m">3</span><span class="p">]</span> <span class="s2">"id_str"</span>                        <span class="s2">"text"</span>                         
 <span class="p">[</span><span class="m">5</span><span class="p">]</span> <span class="s2">"source"</span>                        <span class="s2">"truncated"</span>                    
 <span class="p">[</span><span class="m">7</span><span class="p">]</span> <span class="s2">"in_reply_to_status_id"</span>         <span class="s2">"in_reply_to_status_id_str"</span>    
 <span class="p">[</span><span class="m">9</span><span class="p">]</span> <span class="s2">"in_reply_to_user_id"</span>           <span class="s2">"in_reply_to_user_id_str"</span>      
<span class="p">[</span><span class="m">11</span><span class="p">]</span> <span class="s2">"in_reply_to_screen_name"</span>       <span class="s2">"user"</span>                         
<span class="p">[</span><span class="m">13</span><span class="p">]</span> <span class="s2">"geo"</span>                           <span class="s2">"coordinates"</span>                  
<span class="p">[</span><span class="m">15</span><span class="p">]</span> <span class="s2">"place"</span>                         <span class="s2">"contributors"</span>                 
<span class="p">[</span><span class="m">17</span><span class="p">]</span> <span class="s2">"is_quote_status"</span>               <span class="s2">"retweet_count"</span>                
<span class="p">[</span><span class="m">19</span><span class="p">]</span> <span class="s2">"favorite_count"</span>                <span class="s2">"entities"</span>                     
<span class="p">[</span><span class="m">21</span><span class="p">]</span> <span class="s2">"extended_entities"</span>             <span class="s2">"favorited"</span>                    
<span class="p">[</span><span class="m">23</span><span class="p">]</span> <span class="s2">"retweeted"</span>                     <span class="s2">"possibly_sensitive"</span>           
<span class="p">[</span><span class="m">25</span><span class="p">]</span> <span class="s2">"possibly_sensitive_appealable"</span> <span class="s2">"lang"</span> 

<span class="c1"># further analysis of first tweet on my timeline
</span><span class="n">tweets</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="o">$</span><span class="n">user</span><span class="o">$</span><span class="n">name</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s2">"FiveThirtyEight"</span>

<span class="n">tweets</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="o">$</span><span class="n">text</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s2">"\U0001f3a7 A History Of Data In American Politics (Part 1): William Jennings Bryan to Barack Obama https://t.co/oCKzrXuRHf  https://t.co/6CvKKToxoH"</span>

<span class="n">tweets</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="o">$</span><span class="n">favorite_count</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">3</span></code></pre></figure>

<p>This provides a fairly simple example of incorporating OAuth authorization. The <code class="highlighter-rouge">httr</code> provides several examples of accessing common social network APIs that require OAuth. I recommend you go through several of these examples to get familiar with using OAuth authorization; see them at <code class="highlighter-rouge">demo(package = "httr")</code>. The most difficult aspect of creating your own connections with APIs is gaining an understanding of the API and the arguments they leverage.  This obviously requires time and energy devoted to digging into the API documentation and data library. Next its just a matter of trial and error (likely more the latter than the former) to learn how to translate these arguments into <code class="highlighter-rouge">httr</code> function calls to pull the data of interest.</p>

<p>Also, note that <code class="highlighter-rouge">httr</code> provides several other useful functions not covered here for communicating with APIs (i.e. <code class="highlighter-rouge">POST()</code>, <code class="highlighter-rouge">BROWSE()</code>). For more on these other <code class="highlighter-rouge">httr</code> capabilities see this <a href="https://cran.r-project.org/web/packages/httr/vignettes/quickstart.html">quickstart vignette</a>.</p>

<p><small><a href="#">Go to top</a></small></p>

<p><br /></p>

<h2 id="wrapping-up">Wrapping Up</h2>
<p>As the growth in publicly available data continues, APIs appear to be the preferred medium for access. This will require analysts to become more familiar with interacting with APIs and the prerequisites they often require. R API packages are being developed quickly and should be your first search when looking to request data via an API. As illustrated, these packages tend to be very easy to work with. However, when you want to leverage an organization’s API that has not been integrated into an R package, the <code class="highlighter-rouge">httr</code> package provides a convenient way to request data.</p>

<p><small><a href="#">Go to top</a></small></p>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">

      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
        <center>
          <li>
            <a href="https://github.com/bradleyboehmke">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>
            </a>
            &nbsp;
            <a href="http://www.twitter.com/bradleyboehmke">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>
            </a>
            &nbsp;
            <a href="https://www.linkedin.com/in/brad-boehmke-ph-d-9b0a257">
              <span class="icon  icon--linkedin">
                <svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"  width="25" height="25" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path fill="#828282" d="M13.632 13.635h-2.37V9.922c0-.886-.018-2.025-1.234-2.025-1.235 0-1.424.964-1.424 1.96v3.778h-2.37V6H8.51V7.04h.03c.318-.6 1.092-1.233 2.247-1.233 2.4 0 2.845 1.58 2.845 3.637v4.188zM3.558 4.955c-.762 0-1.376-.617-1.376-1.377 0-.758.614-1.375 1.376-1.375.76 0 1.376.617 1.376 1.375 0 .76-.617 1.377-1.376 1.377zm1.188 8.68H2.37V6h2.376v7.635zM14.816 0H1.18C.528 0 0 .516 0 1.153v13.694C0 15.484.528 16 1.18 16h13.635c.652 0 1.185-.516 1.185-1.153V1.153C16 .516 15.467 0 14.815 0z" fill-rule="nonzero"/>
                </svg>
              </span>
            </a>
          </li>

        </ul>
        </center>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text"></p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
